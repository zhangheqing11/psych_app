<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¿ƒç†å’¨è¯¢å¸ˆåŠ©æ‰‹</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fadeIn { animation: fadeIn 0.5s ease-out forwards; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    // --- Helper function for API calls ---
    const callApi = async ({ systemPrompt, userPrompt, model = 'deepseek-chat', onChunk, onError }) => {
      const apiURL = `${window.location.origin}/api/call-ai`;
      const isStreaming = onChunk && typeof onChunk === 'function';

      try {
        const response = await fetch(apiURL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ model, systemPrompt, userPrompt, stream: isStreaming }),
        });
        if (!response.ok) throw new Error(`API request failed with status ${response.status}`);
        
        if (isStreaming) {
            const reader = response.body.getReader();
            const decoder = new TextDecoder("utf-8");
            let fullResponse = "";
            while (true) {
              const { done, value } = await reader.read();
              if (done) break;
              const chunk = decoder.decode(value);
              const lines = chunk.split("\n");
              for (const line of lines) {
                if (line.startsWith("data: ")) {
                  const dataStr = line.substring(6).trim();
                  if (dataStr === "[DONE]") return fullResponse;
                  try {
                    const data = JSON.parse(dataStr);
                    const deltaContent = data.choices[0]?.delta?.content;
                    if (deltaContent) { fullResponse += deltaContent; onChunk(deltaContent); }
                  } catch (e) { console.error("Error parsing stream data:", e); }
                }
              }
            }
            return fullResponse;
        } else {
             const data = await response.json();
             return data.choices[0].message.content;
        }

      } catch (err) {
        onError(err.message);
        return `å¯¹åç«¯æœåŠ¡å™¨çš„APIè°ƒç”¨å¤±è´¥: ${err.message}`;
      }
    };
    
    const downloadTextAsFile = (content, filename) => {
        const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    };

    // --- Mock Initial Data ---
    const initialClients = [
      { 
        id: 'client-001', name: 'ç‹èŠ³', age: 32, gender: 'å¥³', grade: 'åœ¨èŒ', sexualOrientation: 'å¼‚æ€§æ‹',
        contact: '138********', joinDate: '2023-10-15', referredBy: null, referredClients: ['client-002'],
        historyOfIllness: 'æ— é‡å¤§æ—¢å¾€å²', mentalStateScore: 7, disabilityStatus: 'æ— ', religiousBelief: 'æ— ',
        ethnicIdentity: 'æ±‰æ—', personalFinance: 'ç¨³å®š', familyFinance: 'è‰¯å¥½',
        sessions: [
          { 
            id: 'session-001-1', date: '2023-10-15', summary: 'é¦–æ¬¡è®¿è°ˆï¼Œå»ºç«‹å’¨è¯¢å…³ç³»ã€‚',
            transcript: { name: 'é¦–æ¬¡è®¿è°ˆé€å­—ç¨¿.docx', content: 'æ¨¡æ‹Ÿçš„é€å­—ç¨¿å†…å®¹...' },
            conceptualization: { status: 'Complete', content: 'AIç”Ÿæˆçš„ä¸ªæ¡ˆæ¦‚å¿µåŒ–æŠ¥å‘Šç¤ºä¾‹å†…å®¹...' },
            assessment: { status: 'Complete', content: 'AIç”Ÿæˆçš„æ¥è®¿è€…è¯„ä¼°æŠ¥å‘Šç¤ºä¾‹å†…å®¹...' },
            supervision: { status: 'Pending', conceptualizationUploaded: false, assessmentUploaded: false, content: null }
          },
        ]
      },
      { 
        id: 'client-002', name: 'ææ˜', age: 28, gender: 'ç”·', grade: 'ç¡•å£«åœ¨è¯»', sexualOrientation: 'æœªæä¾›',
        contact: '159********', joinDate: '2024-01-20', referredBy: 'client-001', referredClients: [],
        historyOfIllness: 'æ— ', mentalStateScore: 5, disabilityStatus: 'æ— ', religiousBelief: 'æ— ',
        ethnicIdentity: 'æ±‰æ—', personalFinance: 'ä¾èµ–å®¶åº­', familyFinance: 'ä¸­ç­‰',
        sessions: []
      },
    ];

    // --- PROMPTS ---
    const getConceptualizationPrompt = () => `...`;
    const getAssessmentPrompt = () => `...`;
    const getSupervisionPrompt = () => `...`;

    // --- Main Application Component ---
    const App = () => {
      const { useState, useEffect } = React;
      const [activeSection, setActiveSection] = useState('clientManagement');
      const [clients, setClients] = useState(() => {
        try { return JSON.parse(localStorage.getItem('psychClients')) || initialClients; } 
        catch (e) { return initialClients; }
      });
      const [selectedClient, setSelectedClient] = useState(null);
      const [globalLoadingMessage, setGlobalLoadingMessage] = useState('');

      useEffect(() => { localStorage.setItem('psychClients', JSON.stringify(clients)); }, [clients]);

      const handleUpdateClient = (updatedClientData, callback) => {
        let newClientsState = [...clients];
        const oldClientState = newClientsState.find(c => c.id === updatedClientData.id);
        
        if (oldClientState) {
            const oldReferredBy = oldClientState.referredBy;
            const newReferredBy = updatedClientData.referredBy;
            if (oldReferredBy !== newReferredBy) {
              if (oldReferredBy) {
                const oldReferrerIndex = newClientsState.findIndex(c => c.id === oldReferredBy);
                if (oldReferrerIndex > -1) { newClientsState[oldReferrerIndex].referredClients = newClientsState[oldReferrerIndex].referredClients.filter(id => id !== updatedClientData.id); }
              }
              if (newReferredBy) {
                const newReferrerIndex = newClientsState.findIndex(c => c.id === newReferredBy);
                if (newReferrerIndex > -1) { if (!newClientsState[newReferrerIndex].referredClients.includes(updatedClientData.id)) { newClientsState[newReferrerIndex].referredClients.push(updatedClientData.id); } }
              }
            }
        }
        
        const clientIndex = newClientsState.findIndex(c => c.id === updatedClientData.id);
        if (clientIndex > -1) { newClientsState[clientIndex] = updatedClientData; } 
        else {
            newClientsState.push(updatedClientData);
            const newReferredBy = updatedClientData.referredBy;
            if (newReferredBy) {
                const newReferrerIndex = newClientsState.findIndex(c => c.id === newReferredBy);
                if (newReferrerIndex > -1 && !newClientsState[newReferrerIndex].referredClients.includes(updatedClientData.id)) {
                    newClientsState[newReferrerIndex].referredClients.push(updatedClientData.id);
                }
            }
        }
        
        setClients(newClientsState);
        if (selectedClient?.id === updatedClientData.id || !oldClientState) { setSelectedClient(updatedClientData); }
        if (callback) callback(updatedClientData);
      };

      const handleAddClient = (newClient, clientToEdit) => {
        if(clientToEdit) {
          handleUpdateClient(newClient, clientToEdit);
        } else {
          const clientWithDefaults = { ...newClient, id: `client-${Date.now()}`, sessions: [], joinDate: new Date().toISOString().split('T')[0], referredBy: newClient.referredBy || null, referredClients: [] };
          handleUpdateClient(clientWithDefaults);
          setSelectedClient(clientWithDefaults); 
          setActiveSection('clientDetail');
        }
      };
      
      const handleDeleteClient = (clientId) => {
        const clientToDelete = clients.find(c => c.id === clientId);
        if (!clientToDelete) return;
        let updatedClients = clients.filter(client => client.id !== clientId);
        updatedClients = updatedClients.map(client => {
          if (client.referredBy === clientId) { return { ...client, referredBy: null }; }
          if (client.referredClients.includes(clientId)) { return { ...client, referredClients: client.referredClients.filter(id => id !== clientId) }; }
          return client;
        });
        console.warn(`å°è¯•åˆ é™¤æ¥è®¿è€… ${clientToDelete?.name}ã€‚`);
        setClients(updatedClients);
        if (selectedClient?.id === clientId) { setSelectedClient(null); setActiveSection('clientManagement'); }
      };

      const handleSelectClient = (client) => { setSelectedClient(client); setActiveSection('clientDetail'); };
      
      const renderSection = () => {
        switch (activeSection) {
          case 'clientManagement':
            return <ClientManagementSection clients={clients} onAddClient={handleAddClient} onSelectClient={handleSelectClient} />;
          case 'clientDetail':
            return selectedClient ? 
                   <ClientDetailView 
                      key={selectedClient.id} 
                      client={selectedClient} 
                      allClients={clients} 
                      onUpdateClient={handleUpdateClient} 
                      onDeleteClient={handleDeleteClient}
                      setGlobalLoadingMessage={setGlobalLoadingMessage}
                    /> : 
                   <div className="text-center p-10 text-gray-500">è¯·å…ˆä»åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä½æ¥è®¿è€…ã€‚</div>;
          case 'cbtApplication':
            return <CBTSection />;
          default:
            return <ClientManagementSection clients={clients} onAddClient={handleAddClient} onSelectClient={handleSelectClient} />;
        }
      };

      return (
        <div className="min-h-screen bg-gray-100 flex flex-col">
          <div className="bg-gray-800 text-white shadow-lg"><div className="container mx-auto px-4"><div className="flex items-center justify-between h-16"><div className="flex items-center"><span className="text-2xl mr-3">ğŸ’Œ</span><h1 className="text-xl font-bold">å¿ƒç†å’¨è¯¢å¸ˆåŠ©æ‰‹</h1></div><div className="flex items-baseline space-x-4"><button onClick={()=>setActiveSection('clientManagement')} className={`px-3 py-2 rounded-md text-sm font-medium flex items-center ${activeSection!=='cbtApplication'?'bg-gray-900':'text-gray-300 hover:bg-gray-700'}`}><span className="mr-2">ğŸ‘¥</span>æ¥è®¿è€…ç®¡ç†</button><button onClick={()=>setActiveSection('cbtApplication')} className={`px-3 py-2 ml-4 rounded-md text-sm font-medium flex items-center ${activeSection==='cbtApplication'?'bg-gray-900':'text-gray-300 hover:bg-gray-700'}`}><span className="mr-2">ğŸ› ï¸</span>å’¨è¯¢æµç¨‹è¾…åŠ©å·¥å…· (å¾…å¼€å‘)</button></div></div></div></div>
          {globalLoadingMessage && (<div className="bg-yellow-400 text-yellow-800 text-center p-2 animate-pulse flex items-center justify-center"><span className="mr-2">â³</span>{globalLoadingMessage}</div>)}
          <main className="flex-grow container mx-auto p-4 sm:p-6 lg:p-8">{renderSection()}</main>
        </div>
      );
    };

    const ClientManagementSection = ({ clients, onAddClient, onSelectClient }) => {
        const { useState } = React;
        const [showAddClientModal, setShowAddClientModal] = useState(false);
        const [searchTerm, setSearchTerm] = useState('');
        const filteredClients = clients.filter(client => client.name.toLowerCase().includes(searchTerm.toLowerCase()));
        return (
            <div className="bg-white p-6 rounded-xl shadow-xl animate-fadeIn">
            <div className="flex justify-between items-center mb-6 pb-4 border-b"><h2 className="text-2xl font-semibold text-gray-700 flex items-center"><span className="mr-3 text-2xl">ğŸ‘¥</span>æ¥è®¿è€…ç®¡ç†</h2><button onClick={() => setShowAddClientModal(true)} className="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg flex items-center"><span className="mr-2">â•</span>æ·»åŠ æ–°æ¥è®¿</button></div>
            <input type="text" placeholder="æœç´¢æ¥è®¿è€…å§“å..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="w-full p-3 mb-4 border rounded-lg"/>
            {filteredClients.length > 0 ? (
                <ul className="space-y-3">{filteredClients.map(client => (<li key={client.id} onClick={() => onSelectClient(client)} className="bg-gray-50 hover:bg-blue-50 border rounded-lg p-4 cursor-pointer flex justify-between items-center"><div><p className="text-lg font-medium text-blue-700">{client.name} <span className="text-sm text-gray-500">({client.gender}, {client.age}å²)</span></p><p className="text-sm text-gray-600">åŠ å…¥æ—¥æœŸ: {client.joinDate}</p></div><span className="text-gray-400">â¯</span></li>))}</ul>
            ) : <p className="text-center text-gray-500 py-8">æš‚æ— åŒ¹é…çš„æ¥è®¿è€…ã€‚</p>}
            {showAddClientModal && <AddClientModal onClose={() => setShowAddClientModal(false)} onAddClient={onAddClient} allClients={clients} />}
            </div>
        );
    };

    const AddClientModal = ({ onClose, onAddClient, clientToEdit, allClients }) => {
      const { useState } = React;
      const [formData, setFormData] = useState({
        name: clientToEdit?.name || '', age: clientToEdit?.age || '', gender: clientToEdit?.gender || 'æœªé€éœ²',
        grade: clientToEdit?.grade || '', sexualOrientation: clientToEdit?.sexualOrientation || '',
        contact: clientToEdit?.contact || '', referredBy: clientToEdit?.referredBy || '',
        historyOfIllness: clientToEdit?.historyOfIllness || '', mentalStateScore: clientToEdit?.mentalStateScore || '5',
        disabilityStatus: clientToEdit?.disabilityStatus || '', religiousBelief: clientToEdit?.religiousBelief || '',
        ethnicIdentity: clientToEdit?.ethnicIdentity || '', personalFinance: clientToEdit?.personalFinance || '',
        familyFinance: clientToEdit?.familyFinance || '',
      });
      const handleChange = (e) => { const { name, value } = e.target; setFormData(prev => ({ ...prev, [name]: value })); };
      const handleSubmit = (e) => {
        e.preventDefault(); if (!formData.name.trim() || !formData.age) { console.warn('å§“åå’Œå¹´é¾„ä¸ºå¿…å¡«é¡¹ã€‚'); return; }
        const clientData = { ...formData, age: parseInt(formData.age), referredBy: formData.referredBy || null };
        const dataToSubmit = clientToEdit ? { ...clientToEdit, ...clientData } : clientData;
        onAddClient(dataToSubmit, clientToEdit); onClose();
      };
      const potentialReferrers = allClients.filter(c => c.id !== clientToEdit?.id);
      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 animate-fadeIn">
          <div className="bg-white p-6 rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div className="flex justify-between items-center mb-4 sticky top-0 bg-white py-2 z-10"><h3 className="text-xl font-semibold">{clientToEdit ? 'ç¼–è¾‘' : 'æ·»åŠ '}æ¥è®¿è€…ä¿¡æ¯</h3><button onClick={onClose} className="text-gray-500">âŒ</button></div>
            <form onSubmit={handleSubmit} className="space-y-4">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div><label className="block text-sm font-medium">å§“å <span className="text-red-500">*</span></label><input type="text" name="name" value={formData.name} onChange={handleChange} required className="w-full p-2 border rounded-md" /></div>
                <div><label className="block text-sm font-medium">å¹´é¾„ <span className="text-red-500">*</span></label><input type="number" name="age" value={formData.age} onChange={handleChange} required className="w-full p-2 border rounded-md" /></div>
                <div><label className="block text-sm font-medium">æ€§åˆ«</label><select name="gender" value={formData.gender} onChange={handleChange} className="w-full p-2 border rounded-md"><option>æœªé€éœ²</option><option>ç”·</option><option>å¥³</option><option>å…¶ä»–</option></select></div>
                <div><label className="block text-sm font-medium">åœ¨è¯»å¹´çº§</label><input type="text" name="grade" value={formData.grade} onChange={handleChange} className="w-full p-2 border rounded-md" /></div>
                <div><label className="block text-sm font-medium">æ€§å–å‘</label><input type="text" name="sexualOrientation" value={formData.sexualOrientation} onChange={handleChange} className="w-full p-2 border rounded-md" /></div>
                <div><label className="block text-sm font-medium">è”ç³»æ–¹å¼</label><input type="text" name="contact" value={formData.contact} onChange={handleChange} className="w-full p-2 border rounded-md" /></div>
                <div><label className="block text-sm font-medium">è¢«...ä»‹ç»</label><select name="referredBy" value={formData.referredBy || ''} onChange={handleChange} className="w-full p-2 border rounded-md"><option value="">æ— </option>{potentialReferrers.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}</select></div>
                <div><label className="block text-sm font-medium">å¿ƒç†çŠ¶æ€è¯„åˆ†(1-10)</label><select name="mentalStateScore" value={formData.mentalStateScore} onChange={handleChange} className="w-full p-2 border rounded-md">{[...Array(10).keys()].map(i => <option key={i+1} value={i+1}>{i+1}</option>)}</select></div>
                <div className="md:col-span-2"><label className="block text-sm font-medium">æ—¢å¾€ç—…å²</label><input type="text" name="historyOfIllness" value={formData.historyOfIllness} onChange={handleChange} className="w-full p-2 border rounded-md" /></div>
                <div className="md:col-span-2"><label className="block text-sm font-medium">æ®‹éšœæƒ…å†µ</label><input type="text" name="disabilityStatus" value={formData.disabilityStatus} onChange={handleChange} className="w-full p-2 border rounded-md" /></div>
                <div><label className="block text-sm font-medium">å®—æ•™ä¿¡ä»°</label><input type="text" name="religiousBelief" value={formData.religiousBelief} onChange={handleChange} className="w-full p-2 border rounded-md" /></div>
                <div><label className="block text-sm font-medium">ç§æ—è®¤åŒ</label><input type="text" name="ethnicIdentity" value={formData.ethnicIdentity} onChange={handleChange} className="w-full p-2 border rounded-md" /></div>
                <div><label className="block text-sm font-medium">ä¸ªäººç»æµ</label><input type="text" name="personalFinance" value={formData.personalFinance} onChange={handleChange} className="w-full p-2 border rounded-md" /></div>
                <div><label className="block text-sm font-medium">å®¶åº­ç»æµ</label><input type="text" name="familyFinance" value={formData.familyFinance} onChange={handleChange} className="w-full p-2 border rounded-md" /></div>
              </div>
              <div className="flex justify-end space-x-3 pt-4"><button type="button" onClick={onClose} className="px-4 py-2 bg-gray-100 rounded-md border">å–æ¶ˆ</button><button type="submit" className="px-4 py-2 text-white bg-blue-600 rounded-md flex items-center"><span className="mr-2">ğŸ’¾</span>{clientToEdit ? 'ä¿å­˜' : 'æ·»åŠ '}</button></div>
            </form>
          </div>
        </div>
      );
    };

    const ClientDetailView = ({ client, allClients, onUpdateClient, onDeleteClient, setGlobalLoadingMessage }) => {
      const { useState } = React;
      const [activeTab, setActiveTab] = useState('profile');
      const [showEditModal, setShowEditModal] = useState(false);
      const [isAiLoading, setIsAiLoading] = useState(false);

      const tabs = [{ id: 'profile', label: 'æ¡£æ¡ˆä¸ä¼šè¯', icon: 'ğŸ‘¤' }, { id: 'conceptualization', label: 'AIä¸ªæ¡ˆæ¦‚å¿µåŒ–', icon: 'ğŸ“œ' },{ id: 'supervision', label: 'AIç£å¯¼', icon: 'ğŸ”¬' },{ id: 'analysis', label: 'æ¥è®¿è€…è¯„ä¼°', icon: 'ğŸ“Š' }];
      
      const handleAddSession = (newSessionData) => {
        const newSession = { id: `session-${client.id}-${Date.now()}`, ...newSessionData, transcript: null, conceptualization: { status: 'Pending' }, assessment: { status: 'Pending' }, supervision: { status: 'Pending', conceptualizationUploaded: false, assessmentUploaded: false } };
        onUpdateClient({ ...client, sessions: [...(client.sessions || []), newSession] });
      };

      const handleFileUpload = async (sessionId, file) => {
        if (!file) return;

        setGlobalLoadingMessage(`æ­£åœ¨ä¸Šä¼ æ–‡ä»¶å¹¶ä¸º ${client.name} ç”Ÿæˆåˆæ­¥æŠ¥å‘Š...`);
        setIsAiLoading(true);

        const sessionIndex = client.sessions.findIndex(s => s.id === sessionId);
        if (sessionIndex === -1) { setGlobalLoadingMessage(''); setIsAiLoading(false); return; }

        let updatedClient = JSON.parse(JSON.stringify(client));
        updatedClient.sessions[sessionIndex].conceptualization.status = 'Processing';
        updatedClient.sessions[sessionIndex].assessment.status = 'Processing';
        onUpdateClient(updatedClient);

        const formData = new FormData();
        formData.append('transcript', file);
        formData.append('client_info', JSON.stringify(client));

        try {
            const response = await fetch('/api/upload-and-analyze', { method: 'POST', body: formData });
            if (!response.ok) { const errData = await response.json(); throw new Error(errData.error || `æœåŠ¡å™¨é”™è¯¯: ${response.status}`); }
            const result = await response.json();
            
            const finalClient = JSON.parse(JSON.stringify(updatedClient));
            finalClient.sessions[sessionIndex].transcript = { name: result.uploadedFileName, content: 'ï¼ˆå†…å®¹åœ¨æœåŠ¡å™¨ç«¯å¤„ç†ï¼‰' };
            finalClient.sessions[sessionIndex].conceptualization = result.conceptualization;
            finalClient.sessions[sessionIndex].assessment = result.assessment;
            onUpdateClient(finalClient);
        } catch (error) {
            console.error('æ–‡ä»¶ä¸Šä¼ æˆ–åˆ†æå¤±è´¥:', error);
            const errorClient = JSON.parse(JSON.stringify(updatedClient));
            errorClient.sessions[sessionIndex].conceptualization = {status: 'Error', content: error.message};
            errorClient.sessions[sessionIndex].assessment = {status: 'Error', content: error.message};
            onUpdateClient(errorClient);
        } finally {
            setGlobalLoadingMessage('');
            setIsAiLoading(false);
        }
      };
      
      const handleSupervisionFileUploaded = async (sessionId, fileType) => {
          const sessionIndex = client.sessions.findIndex(s => s.id === sessionId);
          if (sessionIndex === -1) return;
          
          let updatedClient = JSON.parse(JSON.stringify(client));
          updatedClient.sessions[sessionIndex].supervision[fileType + 'Uploaded'] = true;
          
          onUpdateClient(updatedClient, async (finalUpdatedClient) => {
              const finalSession = finalUpdatedClient.sessions.find(s => s.id === sessionId);
              if(finalSession.supervision.conceptualizationUploaded && finalSession.supervision.assessmentUploaded && finalSession.supervision.status !== 'Complete' && finalSession.supervision.status !== 'Processing') {
                  await triggerSupervisionGeneration(finalUpdatedClient, sessionId);
              }
          });
      };
      
      const triggerSupervisionGeneration = async (clientForSupervision, sessionId) => {
          setGlobalLoadingMessage(`æ­£åœ¨ä¸º ${clientForSupervision.name} ç”Ÿæˆæœ€ç»ˆç£å¯¼æŠ¥å‘Š...`);
          setIsAiLoading(true);
          const sessionIndex = clientForSupervision.sessions.findIndex(s => s.id === sessionId);
          
          let processingClient = JSON.parse(JSON.stringify(clientForSupervision));
          processingClient.sessions[sessionIndex].supervision.status = 'Processing';
          onUpdateClient(processingClient);

          try {
              const currentSession = processingClient.sessions[sessionIndex];
              const response = await fetch('/api/generate-supervision', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    client_info: clientForSupervision,
                    transcript_content: currentSession.transcript.content,
                    conceptualization_content: currentSession.conceptualization.content,
                    assessment_content: currentSession.assessment.content
                })
              });
              if (!response.ok) { const errData = await response.json(); throw new Error(errData.error || `æœåŠ¡å™¨é”™è¯¯: ${response.status}`); }
              const result = await response.json();
              
              let finalClient = JSON.parse(JSON.stringify(processingClient));
              finalClient.sessions[sessionIndex].supervision = { 
                  ...finalClient.sessions[sessionIndex].supervision,
                  status: 'Complete', 
                  content: result.supervision.content 
              };
              onUpdateClient(finalClient);
          } catch(error) {
              let errorClient = JSON.parse(JSON.stringify(processingClient));
              errorClient.sessions[sessionIndex].supervision = { ...errorClient.sessions[sessionIndex].supervision, status: 'Error', content: error.message };
              onUpdateClient(errorClient);
          } finally {
              setGlobalLoadingMessage('');
              setIsAiLoading(false);
          }
      };

      const renderTabContent = () => {
        switch (activeTab) {
          case 'profile': return <ClientProfileTab client={client} allClients={allClients} onAddSession={handleAddSession} onFileUpload={handleFileUpload} isAiLoading={isAiLoading} />;
          case 'conceptualization': return <ConceptualizationTab client={client} />;
          case 'supervision': return <SupervisionReportTab client={client} onSupervisionFileUploaded={handleSupervisionFileUploaded} />;
          case 'analysis': return <AnalysisReportTab client={client} />;
          default: return null;
        }
      };

      return (
        <div className="bg-white p-6 rounded-xl shadow-xl animate-fadeIn">
          <div className="flex flex-col md:flex-row justify-between md:items-center mb-4 pb-4 border-b gap-4"><h2 className="text-2xl font-semibold text-gray-700 flex items-center"><span className="mr-3 text-3xl">ğŸ‘¤</span>{client.name} - æ¡£æ¡ˆä¸­å¿ƒ</h2><div><button onClick={() => setShowEditModal(true)} className="text-sm text-blue-600 mr-4 flex items-center"><span className="mr-1">âœï¸</span>ç¼–è¾‘</button><button onClick={() => onDeleteClient(client.id)} className="text-sm text-red-500 flex items-center"><span className="mr-1">ğŸ—‘ï¸</span>åˆ é™¤</button></div></div>
          <div className="border-b border-gray-200"><nav className="-mb-px flex space-x-6 overflow-x-auto">{tabs.map(tab => <button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`flex-shrink-0 whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm flex items-center ${activeTab === tab.id ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'}`}><span className="mr-2">{tab.icon}</span>{tab.label}</button>)}</nav></div>
          <div className="pt-6">{renderTabContent()}</div>
          {showEditModal && <AddClientModal onClose={() => setShowEditModal(false)} onAddClient={onUpdateClient} clientToEdit={client} allClients={allClients}/>}
        </div>
      );
    };
    
    const ClientProfileTab = ({ client, allClients, onAddSession, onFileUpload, isAiLoading }) => {
      const { useState, useRef } = React;
      const [showAddSession, setShowAddSession] = useState(false);
      const [newSessionDate, setNewSessionDate] = useState(new Date().toISOString().split('T')[0]);
      const handleCreateSession = () => { if (!newSessionDate) return; onAddSession({ date: newSessionDate, summary: `å…³äº ${newSessionDate} çš„å’¨è¯¢` }); setShowAddSession(false); };
      
      const SessionCard = ({ session }) => {
        const fileInputRef = useRef(null);
        const status = session.conceptualization?.status === 'Processing' || session.assessment?.status === 'Processing' ? 'Processing' : 
                       (session.conceptualization?.status === 'Complete' && session.assessment?.status === 'Complete') ? 'Complete' : 'Pending';
        
        const handleFileSelect = (event) => {
            const file = event.target.files[0];
            if (file) onFileUpload(session.id, file);
        };

        return (
            <div className={`p-4 bg-white rounded-lg border border-gray-300 shadow-sm ${status === 'Processing' && 'animate-pulse'}`}>
                <p className="font-semibold text-gray-800">å’¨è¯¢æ—¥æœŸ: {session.date}</p>
                <div className="mt-3 p-3 bg-gray-50 rounded-md text-center">
                    <p className="text-sm font-medium text-gray-600">å’¨è¯¢é€å­—ç¨¿</p>
                    {session.transcript ? (<div className="text-green-600 mt-1"><span className="text-xl">âœ…</span><p className="text-xs break-all">{session.transcript.name}</p></div>) : (
                        <>
                            <input type="file" ref={fileInputRef} onChange={handleFileSelect} className="hidden" accept=".txt,.md,.docx"/>
                            <button onClick={() => fileInputRef.current.click()} disabled={isAiLoading} className="mt-1 text-xs bg-indigo-500 text-white py-1 px-2 rounded disabled:opacity-50">ä¸Šä¼ å¹¶ç”ŸæˆAIå†…å®¹</button>
                        </>
                    )}
                </div>
                {session.transcript && <div className="mt-3 text-center text-xs text-gray-500">âœ¨ åˆæ­¥æŠ¥å‘ŠçŠ¶æ€: <span className={status === 'Complete' ? 'text-green-600' : 'text-yellow-600'}>{status}</span></div>}
            </div>
        );
      }
      const referrer = client.referredBy ? allClients.find(c => c.id === client.referredBy) : null;
      const referredList = client.referredClients?.map(id => allClients.find(c => c.id === id)).filter(Boolean);
      return (
        <div className="space-y-6">
            <div className="p-4 bg-gray-50 rounded-lg border">
                <h3 className="text-lg font-semibold text-gray-700 mb-3 flex items-center"><span className="mr-2">â„¹ï¸</span>åŸºæœ¬ä¿¡æ¯</h3>
                <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-x-6 gap-y-4 text-sm">
                    <p><strong>å§“å:</strong> {client.name}</p><p><strong>å¹´é¾„:</strong> {client.age} å²</p><p><strong>æ€§åˆ«:</strong> {client.gender}</p>
                    <p><strong>åœ¨è¯»å¹´çº§:</strong> {client.grade || 'æœªæä¾›'}</p><p><strong>æ€§å–å‘:</strong> {client.sexualOrientation || 'æœªæä¾›'}</p><p><strong>è”ç³»æ–¹å¼:</strong> {client.contact || 'æœªæä¾›'}</p>
                    <p><strong>è¢«...ä»‹ç»:</strong> {referrer ? referrer.name : 'æ— '}</p><p><strong>ä»‹ç»...:</strong> {referredList?.length > 0 ? referredList.map(c => c.name).join(', ') : 'æ— '}</p><p><strong>å¿ƒç†çŠ¶æ€è¯„åˆ†:</strong> {client.mentalStateScore}/10</p>
                    <p className="md:col-span-3"><strong>æ—¢å¾€ç—…å²:</strong> {client.historyOfIllness || 'æœªæä¾›'}</p>
                    <p className="md:col-span-3"><strong>æ®‹éšœæƒ…å†µ:</strong> {client.disabilityStatus || 'æœªæä¾›'}</p>
                    <p><strong>å®—æ•™ä¿¡ä»°:</strong> {client.religiousBelief || 'æœªæä¾›'}</p><p><strong>ç§æ—è®¤åŒ:</strong> {client.ethnicIdentity || 'æœªæä¾›'}</p>
                    <p><strong>ä¸ªäººç»æµ:</strong> {client.personalFinance || 'æœªæä¾›'}</p><p><strong>å®¶åº­ç»æµ:</strong> {client.familyFinance || 'æœªæä¾›'}</p>
                </div>
            </div>
            <div>
                <div className="flex justify-between items-center mb-3"><h3 className="text-lg font-semibold text-gray-700 flex items-center"><span className="mr-2">ğŸ“…</span>å’¨è¯¢ä¼šè¯å·¥ä½œæµ</h3><button onClick={() => setShowAddSession(true)} className="text-sm bg-blue-600 text-white py-1 px-3 rounded-md">æ·»åŠ æ–°ä¼šè¯</button></div>
                {showAddSession && (<div className="p-4 mb-4 bg-blue-50 border rounded-lg flex items-center gap-4"><input type="date" value={newSessionDate} onChange={e => setNewSessionDate(e.target.value)} className="p-2 border rounded-md"/><button onClick={handleCreateSession} className="bg-blue-500 text-white py-2 px-4 rounded-md">åˆ›å»º</button><button onClick={() => setShowAddSession(false)} className="text-gray-600">å–æ¶ˆ</button></div>)}
                <div className="space-y-4">{client.sessions?.length > 0 ? [...client.sessions].reverse().map(session => <SessionCard key={session.id} session={session} />) : <p className="text-center text-gray-500 py-4">æš‚æ— å’¨è¯¢ä¼šè¯è®°å½•ã€‚</p>}</div>
            </div>
        </div>
      );
    };
    
    const ConceptualizationTab = ({ client }) => {
        const { useState, useEffect } = React;
        const aiSessions = (client.sessions || []).filter(s => s.conceptualization && s.conceptualization.status !== 'Pending');
        const [selectedSession, setSelectedSession] = useState(aiSessions.length > 0 ? aiSessions[0] : null);
        useEffect(() => { const sessions = (client.sessions || []).filter(s => s.conceptualization?.status !== 'Pending'); setSelectedSession(sessions.length > 0 ? sessions[0] : null); }, [client]);
        return (
             <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div className="md:col-span-1 bg-gray-50 p-4 rounded-lg border"><h3 className="text-lg font-medium text-gray-700 mb-3">å†å²è®°å½•</h3><ul className="space-y-2 max-h-[60vh] overflow-y-auto pr-2">{aiSessions.length === 0 ? <p className="text-sm text-gray-500 text-center py-4">æš‚æ— è®°å½•ã€‚</p> : [...aiSessions].reverse().map(session => <li key={session.id} onClick={() => setSelectedSession(session)} className={`p-3 rounded-lg cursor-pointer border-2 ${selectedSession?.id === session.id ? 'bg-indigo-100 border-indigo-500' : 'bg-white hover:bg-gray-100 border-transparent'}`}><p className="font-semibold text-indigo-600">å’¨è¯¢æ—¥æœŸ: {session.date}</p><p className={`text-xs font-medium mt-1 ${session.conceptualization.status === 'Complete' ? 'text-green-600' : 'text-red-600'}`}>çŠ¶æ€: {session.conceptualization.status}</p></li>)}</ul></div>
                <div className="md:col-span-2"><h3 className="text-lg font-medium mb-3 text-gray-700">ä¸ªæ¡ˆæ¦‚å¿µåŒ–è¯¦æƒ…</h3>{selectedSession ? <div className="p-4 bg-white border rounded-lg h-full"><div className="flex justify-between items-center mb-2"><h4 className="font-bold text-lg text-indigo-700">å…³äº {selectedSession.date} å’¨è¯¢çš„AIä¸ªæ¡ˆæ¦‚å¿µåŒ–</h4><button onClick={()=>downloadTextAsFile(selectedSession.conceptualization.content, `${client.name}_${selectedSession.date}_ä¸ªæ¡ˆæ¦‚å¿µåŒ–.txt`)} className="text-xs bg-gray-600 text-white py-1 px-2 rounded">ä¸‹è½½</button></div><div className="whitespace-pre-wrap text-gray-800 bg-gray-50 p-3 mt-3 rounded-md overflow-y-auto max-h-[55vh]">{selectedSession.conceptualization.content}</div></div> : <p className="text-gray-500 text-center pt-10">è¯·ä»å·¦ä¾§é€‰æ‹©è®°å½•æŸ¥çœ‹ã€‚</p>}</div>
            </div>
        );
    }
    const SupervisionReportTab = ({ client, onSupervisionFileUploaded }) => {
        const { useState, useEffect } = React;
        const aiSessions = (client.sessions || []).filter(s => s.transcript);
        const [selectedSession, setSelectedSession] = useState(aiSessions.length > 0 ? aiSessions[0] : null);
        useEffect(() => { const sessions = (client.sessions || []).filter(s => s.transcript); setSelectedSession(sessions.length > 0 ? sessions[0] : null); }, [client]);
        return (
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div className="md:col-span-1 bg-gray-50 p-4 rounded-lg border"><h3 className="text-lg font-medium text-gray-700 mb-3">ä¼šè¯åˆ—è¡¨</h3><ul className="space-y-2 max-h-[60vh] overflow-y-auto pr-2">{aiSessions.length === 0 ? <p className="text-sm text-gray-500 text-center py-4">æš‚æ— ä¼šè¯ã€‚</p> : [...aiSessions].reverse().map(session => <li key={session.id} onClick={() => setSelectedSession(session)} className={`p-3 rounded-lg cursor-pointer border-2 ${selectedSession?.id === session.id ? 'bg-blue-100 border-blue-500' : 'bg-white hover:bg-gray-100 border-transparent'}`}><p className="font-semibold text-blue-600">å’¨è¯¢æ—¥æœŸ: {session.date}</p><p className={`text-xs font-medium mt-1 ${session.supervision.status === 'Complete' ? 'text-green-600' : 'text-yellow-600'}`}>{session.supervision.status}</p></li>)}</ul></div>
                <div className="md:col-span-2"><h3 className="text-lg font-medium mb-3 text-gray-700">AIç£å¯¼å·¥ä½œæµ</h3>{selectedSession ? <div className="p-4 bg-white border rounded-lg h-full space-y-4">
                    <div className="p-3 bg-gray-50 rounded-md">
                        <h4 className="text-md font-medium text-gray-700 mb-2">ç¬¬1æ­¥: ä¸Šä¼ AIç”Ÿæˆçš„æŠ¥å‘Š</h4>
                        <div className="grid grid-cols-2 gap-4">
                            <div><p className="text-sm text-center mb-1">ä¸ªæ¡ˆæ¦‚å¿µåŒ–</p><button onClick={() => onSupervisionFileUploaded(selectedSession.id, 'conceptualization')} disabled={selectedSession.supervision.conceptualizationUploaded || selectedSession.conceptualization?.status !== 'Complete'} className="w-full text-xs bg-indigo-500 text-white py-1 px-2 rounded disabled:bg-gray-400">{selectedSession.supervision.conceptualizationUploaded ? 'å·²ä¸Šä¼ âœ…' : 'ä¸Šä¼ '}</button></div>
                            <div><p className="text-sm text-center mb-1">æ¥è®¿è€…è¯„ä¼°</p><button onClick={() => onSupervisionFileUploaded(selectedSession.id, 'assessment')} disabled={selectedSession.supervision.assessmentUploaded || selectedSession.assessment?.status !== 'Complete'} className="w-full text-xs bg-indigo-500 text-white py-1 px-2 rounded disabled:bg-gray-400">{selectedSession.supervision.assessmentUploaded ? 'å·²ä¸Šä¼ âœ…' : 'ä¸Šä¼ '}</button></div>
                        </div>
                        <p className="text-xs text-gray-500 mt-2">è¯·å…ˆç¡®ä¿æ¦‚å¿µåŒ–å’Œè¯„ä¼°æŠ¥å‘Šå·²ç”Ÿæˆã€‚ä¸Šä¼ åå°†è‡ªåŠ¨è§¦å‘æœ€ç»ˆç£å¯¼æŠ¥å‘Šç”Ÿæˆã€‚</p>
                    </div>
                    <div className="p-3 bg-gray-50 rounded-md">
                        <h4 className="text-md font-medium text-gray-700 mb-2">ç¬¬2æ­¥: æŸ¥çœ‹æœ€ç»ˆç£å¯¼æŠ¥å‘Š</h4>
                        {selectedSession.supervision.status === 'Complete' ? <button onClick={()=>downloadTextAsFile(selectedSession.supervision.content, `${client.name}_${selectedSession.date}_ç£å¯¼æŠ¥å‘Š.txt`)} className="text-sm bg-green-500 text-white py-2 px-4 rounded">ä¸‹è½½ç£å¯¼æŠ¥å‘Š</button> : <p className="text-sm text-gray-500">çŠ¶æ€: {selectedSession.supervision.status}</p>}
                    </div>
                </div> : <p className="text-gray-500 text-center pt-10">è¯·ä»å·¦ä¾§é€‰æ‹©ä¸€ä¸ªä¼šè¯ä»¥å¼€å§‹ç£å¯¼æµç¨‹ã€‚</p>}</div>
            </div>
        );
    };

    const AnalysisReportTab = ({ client }) => {
        const { useState, useEffect } = React;
        const aiReports = (client.sessions || []).filter(s => s.assessment && s.assessment.status !== 'Pending');
        const [selectedReportSession, setSelectedReportSession] = useState(aiReports.length > 0 ? aiReports[0] : null);
        useEffect(() => { const reports = (client.sessions || []).filter(s => s.assessment && s.assessment.status !== 'Pending'); setSelectedReportSession(reports.length > 0 ? reports[0] : null); }, [client]);
        return (
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div className="md:col-span-1 bg-gray-50 p-4 rounded-lg border"><h3 className="text-lg font-medium text-gray-700 mb-3">å†å²è¯„ä¼°</h3><ul className="space-y-2 max-h-[60vh] overflow-y-auto pr-2">{aiReports.length === 0 ? <p className="text-sm text-gray-500 text-center py-4">æš‚æ— AIè¯„ä¼°æŠ¥å‘Šã€‚</p> : [...aiReports].reverse().map(session => <li key={session.id} onClick={() => setSelectedReportSession(session)} className={`p-3 rounded-lg cursor-pointer border-2 ${selectedReportSession?.id === session.id ? 'bg-green-100 border-green-500' : 'bg-white hover:bg-gray-100 border-transparent'}`}><p className="font-semibold text-green-600">å’¨è¯¢æ—¥æœŸ: {session.date}</p><p className={`text-xs font-medium mt-1 ${session.assessment.status === 'Complete' ? 'text-green-600' : 'text-red-600'}`}>çŠ¶æ€: {session.assessment.status}</p></li>)}</ul></div>
                <div className="md:col-span-2"><h3 className="text-lg font-medium mb-3 text-gray-700">è¯„ä¼°è¯¦æƒ…</h3>{selectedReportSession ? <div className="p-4 bg-white border rounded-lg h-full"><div className="flex justify-between items-center mb-2"><h4 className="font-bold text-lg text-green-700">å…³äº {selectedReportSession.date} å’¨è¯¢çš„è¯„ä¼°æŠ¥å‘Š</h4><button onClick={()=>downloadTextAsFile(selectedReportSession.assessment.content, `${client.name}_${selectedReportSession.date}_è¯„ä¼°æŠ¥å‘Š.txt`)} className="text-xs bg-gray-600 text-white py-1 px-2 rounded">ä¸‹è½½</button></div><div className="whitespace-pre-wrap text-gray-800 bg-gray-50 p-3 mt-3 rounded-md overflow-y-auto max-h-[55vh]">{selectedReportSession.assessment.content}</div></div> : <p className="text-gray-500 text-center pt-10">è¯·é€‰æ‹©æŠ¥å‘ŠæŸ¥çœ‹ã€‚</p>}</div>
            </div>
        );
    };

    const CBTSection = ({...props}) => {
      const { useState } = React;
      const [userInput, setUserInput] = useState('');
      const [modelResponse, setModelResponse] = useState('');
      const [isLoading, setIsLoading] = useState(false);
      const [error, setError] = useState(null);
      const [activeModel, setActiveModel] = useState(null);
      const handleCBTInteraction = async (model) => {
          if (!userInput.trim()) { console.warn('è¯·è¾“å…¥ã€‚'); return; }
          setIsLoading(true); setActiveModel(model); setError(null); setModelResponse(''); 
          const systemPrompt = "ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„CBTå¿ƒç†å’¨è¯¢å¸ˆã€‚ä½ çš„ä»»åŠ¡æ˜¯ä»¥å…±æƒ…ã€æ”¯æŒå’Œå¼•å¯¼çš„æ–¹å¼ä¸ç”¨æˆ·å¯¹è¯ã€‚å¸®åŠ©ç”¨æˆ·è¯†åˆ«ã€æŒ‘æˆ˜å’Œé‡æ„ä»–ä»¬çš„è‡ªåŠ¨åŒ–è´Ÿæ€§æ€ç»´ã€‚ä½¿ç”¨è‹æ ¼æ‹‰åº•å¼æé—®ï¼Œå¹¶æä¾›å…³äºCBTæ¦‚å¿µçš„å¿ƒç†æ•™è‚²ã€‚ä½ å¿…é¡»ä½¿ç”¨ä¸­æ–‡è¿›è¡Œå›å¤ã€‚";
          await callApi({ systemPrompt, userPrompt: userInput, model, onChunk: (chunk) => setModelResponse(prev => prev + chunk), onError: (err) => setError(`æŠ±æ­‰ï¼Œä¸AIæ¨¡å‹é€šä¿¡å¤±è´¥: ${err}`) });
          setIsLoading(false); setActiveModel(null);
      };
      const LoadingSpinner = () => <svg className="animate-spin mr-2 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle><path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>;
      return (
          <div className="bg-white p-6 rounded-xl shadow-xl animate-fadeIn max-w-4xl mx-auto">
          <h2 className="text-2xl font-semibold mb-6 text-gray-700 border-b pb-3 flex items-center"><span className="text-2xl mr-3">ğŸ§ </span>CBTè¾…åŠ©å·¥å…·</h2>
          <div className="mb-4"><label htmlFor="cbtInput" className="block text-md font-medium text-gray-700 mb-2">è¯·è¾“å…¥ä¸€ä¸ªè‡ªåŠ¨åŒ–æ€ç»´ã€å›°æ‰°æƒ…å¢ƒæˆ–æƒ³è¦æ¢è®¨çš„é—®é¢˜ï¼š</label><textarea id="cbtInput" value={userInput} onChange={(e) => setUserInput(e.target.value)} rows="5" placeholder="ä¾‹å¦‚ï¼šæˆ‘æ€»æ˜¯æ‹…å¿ƒåˆ«äººæ€ä¹ˆçœ‹æˆ‘ï¼Œè§‰å¾—è‡ªå·±ä¸å¤Ÿå¥½..." className="w-full p-3 border rounded-lg"/></div>
          <div className="flex items-center space-x-4">
              <button onClick={() => handleCBTInteraction('deepseek-chat')} disabled={isLoading} className="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2.5 px-6 rounded-lg shadow-md flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">{isLoading && activeModel === 'deepseek-chat' ? <LoadingSpinner /> : <span className="mr-2">âš¡ï¸</span>}è·å–å¿«é€ŸCBTåé¦ˆ</button>
              <button onClick={() => handleCBTInteraction('deepseek-reasoner')} disabled={isLoading} className="bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2.5 px-6 rounded-lg shadow-md flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">{isLoading && activeModel === 'deepseek-reasoner' ? <LoadingSpinner /> : <span className="mr-2">âœ¨</span>}è·å–æ·±åº¦CBTåé¦ˆ</button>
          </div>
          {(modelResponse || error) && (<div className="mt-6 p-5 bg-gray-50 border rounded-lg shadow-inner"><h3 className="text-lg font-semibold text-gray-700 mb-2">æ¨¡å‹åé¦ˆï¼š</h3>{error ? <p className="text-red-500">{error}</p> : <p className="text-gray-800 whitespace-pre-wrap leading-relaxed">{modelResponse}</p>}</div>)}
          <div className="mt-8 p-4 bg-yellow-100 border text-yellow-800 rounded-lg"><h4 className="text-md font-semibold mb-1">APIå¯†é’¥å®‰å…¨æç¤ºï¼š</h4><p className="text-sm">ä¸ºæ–¹ä¾¿æ¼”ç¤ºï¼ŒAPIå¯†é’¥ç›´æ¥å†™åœ¨å‰ç«¯ä»£ç ä¸­ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¯·åŠ¡å¿…é€šè¿‡åç«¯æœåŠ¡å™¨è°ƒç”¨APIä»¥ä¿è¯å®‰å…¨ã€‚</p></div>
          </div>
      );
    };

    const InfoCard = ({ title, value, icon }) => ( <div className="bg-white p-4 rounded-lg shadow-md border flex items-center">{icon && <div className="mr-3 text-2xl">{icon}</div>}<div><p className="text-sm text-gray-500">{title}</p><p className="text-xl font-semibold text-gray-800">{value}</p></div></div> );
    
    // Mount the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
