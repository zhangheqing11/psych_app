<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¿ƒç†å’¨è¯¢å¸ˆåŠ©æ‰‹</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', 'Helvetica Neue', 'Arial', sans-serif; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fadeIn { animation: fadeIn 0.5s ease-out forwards; }
    .custom-modal-backdrop {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background-color: rgba(0, 0, 0, 0.6);
      display: flex; align-items: center; justify-content: center;
      z-index: 1000;
    }
    .custom-modal-content {
      background: white; padding: 2rem; border-radius: 0.75rem;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      text-align: center; max-width: 90%; width: 450px;
    }
    .custom-modal-button {
      margin-top: 1.5rem; padding: 0.75rem 1.5rem; border-radius: 0.5rem;
      border: none; background-color: #3B82F6; color: white;
      font-weight: 600; cursor: pointer; transition: background-color 0.2s;
    }
    .custom-modal-button:hover { background-color: #2563EB; }
    .time-slot:hover { background-color: #eff6ff; cursor: pointer; }
  </style>
</head>
<body class="bg-gray-100">
  <div id="root"></div>

  <script type="text/babel">
    const App = () => {
      const { useState, useEffect, useCallback } = React;
      
      const [appData, setAppData] = useState({ clients: [], counselors: [], appointments: [] });
      const [isLoading, setIsLoading] = useState(true);
      const [currentUser, setCurrentUser] = useState(null); // Will store username

      const [activeSection, setActiveSection] = useState('schedule');
      const [selectedClient, setSelectedClient] = useState(null);
      const [globalLoadingMessage, setGlobalLoadingMessage] = useState('');
      const [alertInfo, setAlertInfo] = useState({ show: false, message: '' });

      const showAlert = useCallback((message) => {
        setAlertInfo({ show: true, message });
      }, []);
      
      // Fetch data when user logs in
      useEffect(() => {
        if (currentUser) {
          setIsLoading(true);
          fetch(`/api/data/${currentUser}`)
            .then(res => res.json())
            .then(data => {
              setAppData(data);
              setIsLoading(false);
            })
            .catch(error => {
              console.error("Failed to fetch data:", error);
              showAlert("åŠ è½½æ•°æ®å¤±è´¥ã€‚");
              setIsLoading(false);
            });
        } else {
            // Clear data on logout
            setAppData({ clients: [], counselors: [], appointments: [] });
            setIsLoading(false);
        }
      }, [currentUser]);

      const saveData = useCallback(async (dataToSave) => {
          if (!currentUser) {
            showAlert("è¯·å…ˆç™»å½•ã€‚");
            return;
          }
          try {
            const response = await fetch(`/api/data/${currentUser}`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(dataToSave),
            });
            if (!response.ok) {
              const err = await response.json();
              throw new Error(err.message || "ä¿å­˜å¤±è´¥");
            }
          } catch (error) {
              console.error("Failed to save data:", error);
              showAlert(`ä¿å­˜æ•°æ®å¤±è´¥: ${error.message}`);
          }
      }, [currentUser]);

      const handleRegister = async (username, password) => {
        try {
            const response = await fetch('/api/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password }),
            });
            const data = await response.json();
            if (response.ok) {
                showAlert(data.message);
                setCurrentUser(data.username); // Automatically log in
                return true;
            } else {
                showAlert(data.message);
                return false;
            }
        } catch (error) {
            showAlert('æ³¨å†Œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥ã€‚');
            return false;
        }
      };

      const handleLogin = async (username, password) => {
        try {
            const response = await fetch('/api/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password }),
            });
            const data = await response.json();
            if (response.ok) {
                showAlert(data.message);
                setCurrentUser(data.username);
                return true;
            } else {
                showAlert(data.message);
                return false;
            }
        } catch(error) {
            showAlert('ç™»å½•è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥ã€‚');
            return false;
        }
      };
      
      const handleLogout = () => {
          setCurrentUser(null);
      }
      
      const handleUpdateData = (newData) => {
        const updatedData = { ...appData, ...newData };
        setAppData(updatedData);
        saveData(updatedData);
      };

      const handleUpdateClient = (updatedClientData, callback) => {
          let newClientsState = [...appData.clients];
          const clientIndex = newClientsState.findIndex(c => c.id === updatedClientData.id);
          
          if (clientIndex > -1) {
              newClientsState[clientIndex] = updatedClientData;
          } else {
              newClientsState.push(updatedClientData);
          }
          
          handleUpdateData({ clients: newClientsState });
          
          if (selectedClient?.id === updatedClientData.id || clientIndex === -1) {
              setSelectedClient(updatedClientData);
          }
          if (callback) callback(updatedClientData);
      };

      const handleAddClient = (newClientData, clientToEdit) => {
          if (clientToEdit) {
              handleUpdateClient({ ...clientToEdit, ...newClientData });
          } else {
              const clientWithDefaults = {
                  ...newClientData,
                  id: `client-${Date.now()}`,
                  sessions: [],
                  joinDate: new Date().toISOString().split('T')[0],
                  referredBy: newClientData.referredBy || null,
                  referredClients: [],
              };
              handleUpdateClient(clientWithDefaults);
          }
      };
      
      const handleDeleteClient = (clientId) => {
        const clientToDelete = appData.clients.find(c => c.id === clientId);
        if (!clientToDelete) return;

        const updatedClients = appData.clients.filter(client => client.id !== clientId);
        const updatedCounselors = appData.counselors.map(counselor => ({
            ...counselor,
            assignedClientIds: counselor.assignedClientIds.filter(id => id !== clientId)
        }));
        const updatedAppointments = appData.appointments.filter(appt => appt.clientId !== clientId);
        
        handleUpdateData({
            clients: updatedClients,
            counselors: updatedCounselors,
            appointments: updatedAppointments
        });

        showAlert(`æ¥è®¿è€… ${clientToDelete?.name} å·²è¢«åˆ é™¤ã€‚`);
        if (selectedClient?.id === clientId) {
            setSelectedClient(null);
            setActiveSection('clientManagement');
        }
      };
      
      const handleUpdateCounselors = (updatedCounselors) => {
          handleUpdateData({ counselors: updatedCounselors });
      };

      const handleDeleteCounselor = (counselorId) => {
          if (appData.appointments.some(appt => appt.counselorId === counselorId)) {
              showAlert('æ— æ³•åˆ é™¤è¯¥å’¨è¯¢å¸ˆï¼Œå› ä¸ºå…¶ä»æœ‰å…³è”çš„æ—¥ç¨‹å®‰æ’ã€‚è¯·å…ˆç§»é™¤ç›¸å…³æ—¥ç¨‹ã€‚');
              return;
          }
          const updatedCounselors = appData.counselors.filter(c => c.id !== counselorId);
          handleUpdateData({ counselors: updatedCounselors });
          showAlert('å’¨è¯¢å¸ˆå·²åˆ é™¤ã€‚');
      };

      const handleUpdateAppointments = (appointmentData, isDelete = false) => {
          let updatedAppointments;
            if (isDelete) {
                updatedAppointments = appData.appointments.filter(appt => appt.id !== appointmentData.id);
            } else {
                const existingIndex = appData.appointments.findIndex(appt => appt.id === appointmentData.id);
                if (existingIndex > -1) {
                    updatedAppointments = [...appData.appointments];
                    updatedAppointments[existingIndex] = appointmentData;
                } else {
                   updatedAppointments = [...appData.appointments, {...appointmentData, id: `appt-${Date.now()}`}];
                }
            }
            handleUpdateData({ appointments: updatedAppointments });
      };

      const handleSelectClient = (client) => { setSelectedClient(client); setActiveSection('clientDetail'); };
      
      const navItems = [
          { id: 'clientManagement', label: 'æ¥è®¿è€…ç®¡ç†', icon: 'ğŸ‘¥' },
          { id: 'counselorManagement', label: 'å’¨è¯¢å¸ˆç®¡ç†', icon: 'ğŸ§‘â€ğŸ«' },
          { id: 'schedule', label: 'å’¨è¯¢æ—¥ç¨‹', icon: 'ğŸ—“ï¸' },
          { id: 'cbtApplication', label: 'è¾…åŠ©å·¥å…·', icon: 'ğŸ§ ' }
      ];

      const renderSection = () => {
        if (isLoading) {
            return <div className="text-center p-10 text-gray-600 font-semibold">æ­£åœ¨åŠ è½½...</div>;
        }
        switch (activeSection) {
          case 'clientManagement':
            return <ClientManagementSection clients={appData.clients} onAddClient={handleAddClient} onSelectClient={handleSelectClient} />;
          case 'counselorManagement':
            return <CounselorManagementSection counselors={appData.counselors} clients={appData.clients} appointments={appData.appointments} onUpdateCounselors={handleUpdateCounselors} onDeleteCounselor={handleDeleteCounselor} />;
          case 'schedule':
            return <ScheduleSection appointments={appData.appointments} clients={appData.clients} counselors={appData.counselors} onUpdateAppointments={handleUpdateAppointments} />;
          case 'clientDetail':
            return selectedClient ? 
                   <ClientDetailView 
                      key={selectedClient.id + JSON.stringify(selectedClient.sessions)} 
                      client={selectedClient} 
                      allClients={appData.clients} 
                      onUpdateClient={handleUpdateClient} 
                      onDeleteClient={handleDeleteClient}
                      globalLoadingMessage={globalLoadingMessage}
                      setGlobalLoadingMessage={setGlobalLoadingMessage}
                      showAlert={showAlert}
                    /> : 
                   <div className="text-center p-10 text-gray-500">è¯·å…ˆä»â€œæ¥è®¿è€…ç®¡ç†â€é¡µé¢é€‰æ‹©ä¸€ä½æ¥è®¿è€…ã€‚</div>;
          case 'cbtApplication':
            return <CBTSection showAlert={showAlert}/>;
          default:
            return <ScheduleSection appointments={appData.appointments} clients={appData.clients} counselors={appData.counselors} onUpdateAppointments={handleUpdateAppointments} />;
        }
      };

      if (!currentUser) {
          return <AuthModal onLogin={handleLogin} onRegister={handleRegister} showAlert={showAlert} />;
      }

      return (
        <div className="min-h-screen bg-gray-50 flex flex-col">
          {alertInfo.show && (
            <div className="custom-modal-backdrop animate-fadeIn" onClick={() => setAlertInfo({ show: false, message: '' })}>
              <div className="custom-modal-content" onClick={(e) => e.stopPropagation()}>
                <p className="text-gray-800">{alertInfo.message}</p>
                <button className="custom-modal-button" onClick={() => setAlertInfo({ show: false, message: '' })}>å…³é—­</button>
              </div>
            </div>
          )}
          <header className="bg-white shadow-sm sticky top-0 z-40"><div className="container mx-auto px-4"><div className="flex items-center justify-between h-16">
          <button onClick={() => setActiveSection('schedule')} className="flex items-center cursor-pointer">
            <span className="text-2xl mr-3">ğŸ’Œ</span>
            <h1 className="text-xl font-bold text-gray-800">å¿ƒç†å’¨è¯¢å¸ˆåŠ©æ‰‹</h1>
          </button>
          <div className="flex items-center gap-4">
            <nav className="hidden md:flex items-center space-x-1">
                {navItems.map(item => (
                    <button 
                        key={item.id} 
                        onClick={()=>setActiveSection(item.id)} 
                        className={`px-3 py-2 rounded-md text-sm font-medium flex items-center transition-colors duration-200 ${activeSection === item.id || (activeSection === 'clientDetail' && item.id === 'clientManagement') ? 'bg-blue-50 text-blue-600' : 'text-gray-500 hover:bg-gray-100'}`}
                    >
                        <span className="mr-2">{item.icon}</span>{item.label}
                    </button>
                ))}
            </nav>
            <div className="border-l pl-4 flex items-center gap-2">
                <span className="text-sm text-gray-500 hidden lg:inline">{currentUser}</span>
                <button onClick={handleLogout} className="text-sm font-medium text-gray-500 hover:text-red-600">ç™»å‡º</button>
            </div>
           </div>
          </div></div></header>
          {globalLoadingMessage && (<div className="bg-yellow-100 text-yellow-800 text-center p-2 animate-pulse flex items-center justify-center sticky top-16 z-30"><span className="mr-2">â³</span>{globalLoadingMessage}</div>)}
          <main className="flex-grow container mx-auto p-4 sm:p-6 lg:p-8">{renderSection()}</main>
        </div>
      );
    };
    
    // --- Components (No changes needed below this line, but included for completeness) ---
    
    const AuthModal = ({ onLogin, onRegister, showAlert }) => {
        const { useState } = React;
        const [mode, setMode] = useState('login'); // login or register
        const [username, setUsername] = useState('');
        const [password, setPassword] = useState('');
        const [confirmPassword, setConfirmPassword] = useState('');

        const handleLoginAttempt = async (e) => {
            e.preventDefault();
            if (!username || !password) { showAlert('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚'); return; }
            await onLogin(username, password);
        };
        
        const handleRegisterAttempt = async (e) => {
            e.preventDefault();
            if (!username || !password || !confirmPassword) { showAlert('è¯·å¡«å†™æ‰€æœ‰å­—æ®µã€‚'); return; }
            if (password.length < 6) { showAlert('å¯†ç å¿…é¡»è‡³å°‘ä¸º6ä¸ªå­—ç¬¦ã€‚'); return; }
            if (password !== confirmPassword) { showAlert('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸åŒ¹é…ï¼'); return; }
            await onRegister(username, password);
        };

        return (
            <div className="min-h-screen bg-gray-100 flex items-center justify-center p-4">
                <div className="w-full max-w-md bg-white rounded-lg shadow-xl p-8 animate-fadeIn">
                   {mode === 'login' ? (
                       <div>
                           <h2 className="text-2xl font-bold text-center text-gray-800 mb-6">ç™»å½•</h2>
                           <form onSubmit={handleLoginAttempt} className="space-y-4">
                               <div><label className="text-sm font-medium text-gray-700">ç”¨æˆ·å</label><input type="text" value={username} onChange={e => setUsername(e.target.value)} className="w-full p-2 mt-1 border rounded-md" /></div>
                               <div><label className="text-sm font-medium text-gray-700">å¯†ç </label><input type="password" value={password} onChange={e => setPassword(e.target.value)} className="w-full p-2 mt-1 border rounded-md" /></div>
                               <button type="submit" className="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 font-semibold">ç™»å½•</button>
                           </form>
                           <p className="text-xs text-center text-gray-500 mt-4">æ²¡æœ‰è´¦æˆ·ï¼Ÿ <button onClick={() => setMode('register')} className="text-blue-600 hover:underline">ç‚¹å‡»æ³¨å†Œ</button></p>
                       </div>
                   ) : (
                       <div>
                           <h2 className="text-2xl font-bold text-center text-gray-800 mb-6">æ³¨å†Œ</h2>
                           <form onSubmit={handleRegisterAttempt} className="space-y-4">
                               <div><label className="text-sm font-medium text-gray-700">ç”¨æˆ·å</label><input type="text" value={username} onChange={e => setUsername(e.target.value)} className="w-full p-2 mt-1 border rounded-md" /></div>
                               <div><label className="text-sm font-medium text-gray-700">å¯†ç </label><input type="password" value={password} onChange={e => setPassword(e.target.value)} className="w-full p-2 mt-1 border rounded-md" /></div>
                               <div><label className="text-sm font-medium text-gray-700">ç¡®è®¤å¯†ç </label><input type="password" value={confirmPassword} onChange={e => setConfirmPassword(e.target.value)} className="w-full p-2 mt-1 border rounded-md" /></div>
                               <button type="submit" className="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 font-semibold">æ³¨å†Œ</button>
                           </form>
                           <p className="text-xs text-center text-gray-500 mt-4">å·²æœ‰è´¦æˆ·ï¼Ÿ <button onClick={() => setMode('login')} className="text-blue-600 hover:underline">è¿”å›ç™»å½•</button></p>
                       </div>
                   )}
                </div>
            </div>
        );
    };

    // The rest of the components remain the same as the previous version
    // ClientManagementSection, ClientForm, CounselorManagementSection, CounselorForm, 
    // ScheduleSection, AppointmentForm, ClientDetailView, ClientProfileTabs, etc.
    // I have omitted them here for brevity but they should be included in the final file.
    // NOTE: The full code is required. I'll paste the rest of the components here.

    const CounselorManagementSection = ({ counselors, clients, appointments, onUpdateCounselors, onDeleteCounselor }) => {
        const { useState, useMemo } = React;
        const [view, setView] = useState('list'); // 'list' or 'form'
        const [counselorToEdit, setCounselorToEdit] = useState(null);
        
        const counselorsWithHours = useMemo(() => {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            return counselors.map(counselor => {
                const monthlyHours = appointments.filter(appt => {
                    if (!appt.date) return false;
                    const apptDate = new Date(appt.date);
                    return appt.counselorId === counselor.id &&
                           apptDate.getMonth() === currentMonth &&
                           apptDate.getFullYear() === currentYear;
                }).length; // Each appointment is 1 hour
                const totalHours = appointments.filter(appt => appt.counselorId === counselor.id).length;
                return { ...counselor, monthlyHours, totalHours };
            });
        }, [counselors, appointments]);

        if (view === 'form') {
            return <CounselorForm 
                onSave={(counselorData) => {
                    let updatedList;
                    if (counselorToEdit) {
                        updatedList = counselors.map(c => c.id === counselorToEdit.id ? { ...counselorToEdit, ...counselorData } : c);
                    } else {
                        updatedList = [...counselors, { ...counselorData, id: `counselor-${Date.now()}`, assignedClientIds: counselorData.assignedClientIds || [] }];
                    }
                    onUpdateCounselors(updatedList);
                    setView('list');
                }}
                onCancel={() => setView('list')}
                counselorToEdit={counselorToEdit}
                allClients={clients}
            />
        }

        const openEditForm = (counselor) => {
            setCounselorToEdit(counselor);
            setView('form');
        };

        return (
            <div className="bg-white p-6 rounded-lg shadow-md animate-fadeIn">
                <div className="flex justify-between items-center mb-6 pb-4 border-b"><h2 className="text-2xl font-semibold text-gray-700 flex items-center"><span className="mr-3 text-2xl">ğŸ§‘â€ğŸ«</span>å’¨è¯¢å¸ˆç®¡ç†</h2><button onClick={() => { setCounselorToEdit(null); setView('form'); }} className="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg flex items-center shadow-sm"><span className="mr-2">â•</span>æ·»åŠ å’¨è¯¢å¸ˆ</button></div>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {counselorsWithHours.map(counselor => {
                        const assignedClients = clients.filter(client => counselor.assignedClientIds?.includes(client.id));
                        return (
                            <div key={counselor.id} className="bg-gray-50 border rounded-lg p-4 flex flex-col">
                                <div className="flex-grow">
                                    <div className="flex justify-between items-start">
                                        <div>
                                            <h3 className="text-xl font-bold text-blue-700">{counselor.name}</h3>
                                            <p className="text-sm text-gray-600 mt-1">{counselor.modality}</p>
                                        </div>
                                        <div className="text-right flex gap-4">
                                            <div>
                                                <p className="text-sm text-gray-600">æœ¬æœˆ</p>
                                                <p className="text-2xl font-bold text-blue-800">{counselor.monthlyHours} <span className="text-base font-normal">å°æ—¶</span></p>
                                            </div>
                                             <div>
                                                <p className="text-sm text-gray-600">æ€»è®¡</p>
                                                <p className="text-2xl font-bold text-gray-800">{counselor.totalHours} <span className="text-base font-normal">å°æ—¶</span></p>
                                            </div>
                                        </div>
                                    </div>
                                    <p className="text-sm text-gray-500 mt-2 mb-4">{counselor.email}</p>
                                    
                                    <h4 className="text-sm font-bold text-gray-700 mt-4 border-t pt-3">è´Ÿè´£æ¥è®¿:</h4>
                                    {assignedClients.length > 0 ? (
                                        <div className="flex flex-wrap gap-2 mt-2">
                                            {assignedClients.map(client => <span key={client.id} className="text-xs bg-gray-200 text-gray-800 px-2 py-1 rounded-full">{client.name}</span>)}
                                        </div>
                                    ) : <p className="text-xs text-gray-500 mt-2">æš‚æ— </p>}
                                </div>
                                <div className="flex justify-end space-x-2 mt-4 pt-4 border-t">
                                    <button onClick={() => openEditForm(counselor)} className="text-xs font-medium text-blue-600 hover:underline">ç¼–è¾‘</button>
                                    <button onClick={() => onDeleteCounselor(counselor.id)} className="text-xs font-medium text-red-600 hover:underline">åˆ é™¤</button>
                                </div>
                            </div>
                        )
                    })}
                </div>
                 {counselors.length === 0 && <p className="text-center text-gray-500 py-8">æš‚æ— å’¨è¯¢å¸ˆä¿¡æ¯ã€‚ç‚¹å‡»â€œæ·»åŠ å’¨è¯¢å¸ˆâ€å¼€å§‹ã€‚</p>}
            </div>
        );
    };

    const CounselorForm = ({ onSave, onCancel, counselorToEdit, allClients }) => {
        const { useState } = React;
        const [formData, setFormData] = useState({
            name: counselorToEdit?.name || '',
            modality: counselorToEdit?.modality || '',
            email: counselorToEdit?.email || '',
            assignedClientIds: counselorToEdit?.assignedClientIds || [],
        });
        
        const handleClientSelection = (clientId) => {
             setFormData(prev => {
                const newIds = prev.assignedClientIds.includes(clientId)
                    ? prev.assignedClientIds.filter(id => id !== clientId)
                    : [...prev.assignedClientIds, clientId];
                return {...prev, assignedClientIds: newIds};
            });
        };

        const handleChange = (e) => {
            const { name, value } = e.target;
            setFormData(prev => ({...prev, [name]: value}));
        };

        const handleSubmit = (e) => {
            e.preventDefault();
            if (!formData.name.trim()) { alert('å§“åä¸èƒ½ä¸ºç©º'); return; }
            onSave(formData);
        };

        return (
            <div className="bg-white p-6 rounded-lg shadow-md animate-fadeIn">
              <div className="flex justify-between items-center mb-4 pb-4 border-b">
                <h3 className="text-2xl font-semibold text-gray-700">{counselorToEdit ? 'ç¼–è¾‘' : 'æ·»åŠ '}å’¨è¯¢å¸ˆ</h3>
                <button onClick={onCancel} className="text-sm font-medium text-gray-600 hover:text-gray-900">â† è¿”å›åˆ—è¡¨</button>
              </div>
                <form onSubmit={handleSubmit} className="space-y-4 max-w-lg mx-auto">
                  <div><label className="block text-sm font-medium">å§“å <span className="text-red-500">*</span></label><input type="text" name="name" value={formData.name} onChange={handleChange} required className="w-full p-2 border rounded-md" /></div>
                  <div><label className="block text-sm font-medium">æ“…é•¿å’¨è¯¢æµæ´¾</label><input type="text" name="modality" value={formData.modality} onChange={handleChange} className="w-full p-2 border rounded-md" /></div>
                  <div><label className="block text-sm font-medium">é‚®ç®±</label><input type="email" name="email" value={formData.email} onChange={handleChange} className="w-full p-2 border rounded-md" /></div>
                  
                  <div>
                    <label className="block text-sm font-medium">è´Ÿè´£æ¥è®¿ (å¯ç‚¹å‡»é€‰æ‹©)</label>
                    <div className="max-h-32 overflow-y-auto border rounded-md p-2 mt-1 select-none">
                        {allClients.map(client => (
                            <div 
                                key={client.id} 
                                onClick={() => handleClientSelection(client.id)}
                                className={`p-1 rounded cursor-pointer ${formData.assignedClientIds.includes(client.id) ? 'bg-blue-200' : 'hover:bg-gray-100'}`}
                            >
                                <span className="text-sm text-gray-800">{client.name}</span>
                            </div>
                        ))}
                         {allClients.length === 0 && <p className="text-xs text-gray-400 text-center py-2">æš‚æ— æ¥è®¿è€…</p>}
                    </div>
                  </div>

                  <div className="flex justify-end space-x-3 pt-4 border-t mt-6">
                    <button type="button" onClick={onCancel} className="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-md border">å–æ¶ˆ</button>
                    <button type="submit" className="px-4 py-2 text-white bg-blue-600 hover:bg-blue-700 rounded-md flex items-center shadow-sm">
                        <span className="mr-2">ğŸ’¾</span>ä¿å­˜
                    </button>
                  </div>
                </form>
            </div>
        );
    };

    const ScheduleSection = ({ appointments, clients, counselors, onUpdateAppointments }) => {
        const { useState } = React;
        const [view, setView] = useState('daily'); // 'daily', 'overview', or 'form'
        const [appointmentToEdit, setAppointmentToEdit] = useState(null);
        
        if (view === 'form') {
            return (
                <AppointmentForm
                    onSave={(appointmentData) => {
                        onUpdateAppointments(appointmentData);
                        setView('daily');
                    }}
                    onCancel={() => setView('daily')}
                    onDelete={(appointmentData) => {
                        onUpdateAppointments(appointmentData, true);
                        setView('daily');
                    }}
                    appointmentToEdit={appointmentToEdit}
                    clients={clients}
                    counselors={counselors}
                />
            )
        }

        return (
            <div className="bg-white p-6 rounded-lg shadow-md animate-fadeIn">
                <div className="flex flex-wrap justify-between items-center mb-6 pb-4 border-b gap-4">
                   <h2 className="text-2xl font-semibold text-gray-700 flex items-center"><span className="mr-3 text-2xl">ğŸ—“ï¸</span>å’¨è¯¢æ—¥ç¨‹</h2>
                   <div className="flex items-center gap-4">
                       <div className="flex items-center bg-gray-100 rounded-lg p-1">
                           <button onClick={() => setView('daily')} className={`px-3 py-1 text-sm rounded-md ${view === 'daily' ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-600'}`}>æ¯æ—¥è§†å›¾</button>
                           <button onClick={() => setView('overview')} className={`px-3 py-1 text-sm rounded-md ${view === 'overview' ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-600'}`}>ä¸‰æœˆæ€»è§ˆ</button>
                       </div>
                       <button onClick={() => { setAppointmentToEdit(null); setView('form');}} className="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg flex items-center shadow-sm"><span className="mr-2">â•</span>æ·»åŠ æ—¥ç¨‹</button>
                   </div>
                </div>
                
                {view === 'daily' && 
                    <ScheduleDailyView 
                        appointments={appointments}
                        clients={clients}
                        counselors={counselors}
                        onSelectAppointment={(appt) => { setAppointmentToEdit(appt); setView('form'); }}
                    />
                }

                {view === 'overview' && <ScheduleOverview appointments={appointments} /> }

            </div>
        );
    };
    
    const ScheduleDailyView = ({ appointments, clients, counselors, onSelectAppointment }) => {
        const { useState, useMemo } = React;
        const [currentDate, setCurrentDate] = useState(new Date());

        const changeDay = (offset) => {
            setCurrentDate(prev => {
                const newDate = new Date(prev);
                newDate.setDate(prev.getDate() + offset);
                return newDate;
            });
        };
        
        const appointmentsForDay = useMemo(() => {
            const dateStr = currentDate.toISOString().split('T')[0];
            return appointments.filter(appt => appt.date === dateStr);
        }, [appointments, currentDate]);

        const renderHourlySchedule = () => {
            const hours = Array.from({length: 15}, (_, i) => 8 + i); // 8:00 to 22:00

            return hours.map(hour => {
                const timeStr = `${String(hour).padStart(2, '0')}:00`;
                const appointment = appointmentsForDay.find(a => a.time === timeStr);
                
                return (
                    <tr key={hour} className="border-b">
                        <td className="p-2 w-24 text-center text-sm text-gray-500 align-top">{timeStr}</td>
                        <td 
                            className="p-1 time-slot"
                            onClick={() => onSelectAppointment(appointment)}
                        >
                            {appointment ? (
                                <div className="bg-blue-100 border-l-4 border-blue-500 p-2 rounded-r-lg cursor-pointer">
                                    <p className="font-bold text-sm text-blue-800">{clients.find(c => c.id === appointment.clientId)?.name}</p>
                                    <p className="text-xs text-gray-600">å’¨è¯¢å¸ˆ: {counselors.find(c => c.id === appointment.counselorId)?.name}</p>
                                    {appointment.location && <p className="text-xs text-gray-600">åœ°ç‚¹: {appointment.location}</p>}
                                    {appointment.notes && <p className="text-xs text-gray-500 mt-1 italic">"{appointment.notes}"</p>}
                                </div>
                            ) : null}
                        </td>
                    </tr>
                );
            });
        };

        return (
            <div>
                 <div className="flex justify-between items-center mb-4">
                    <button onClick={() => changeDay(-1)} className="p-2 rounded-md hover:bg-gray-100">â® å‰ä¸€å¤©</button>
                    <h3 className="text-xl font-semibold text-gray-700">{currentDate.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric' })}</h3>
                    <button onClick={() => changeDay(1)} className="p-2 rounded-md hover:bg-gray-100">åä¸€å¤© â¯</button>
                </div>
                <div className="border rounded-lg overflow-hidden">
                    <table className="w-full">
                        <thead className="bg-gray-50">
                            <tr>
                                <th className="p-2 w-24 text-sm font-medium text-gray-600">æ—¶é—´</th>
                                <th className="p-2 text-sm font-medium text-gray-600 text-left">å®‰æ’</th>
                            </tr>
                        </thead>
                        <tbody>
                            {renderHourlySchedule()}
                        </tbody>
                    </table>
                </div>
            </div>
        )
    };

    const ScheduleOverview = ({ appointments }) => {
        const { useMemo } = React;
        const appointmentsByDate = useMemo(() => {
            return appointments.reduce((acc, appt) => {
                if(appt.date) {
                    (acc[appt.date] = acc[appt.date] || []).push(appt);
                }
                return acc;
            }, {});
        }, [appointments]);

        const renderMonth = (date) => {
            const year = date.getFullYear();
            const month = date.getMonth();
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const days = [];
            
            for (let i = 0; i < firstDay; i++) {
                days.push(<div key={`empty-${i}`} className="border-t border-l"></div>);
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dayAppointments = appointmentsByDate[dateStr] || [];
                const appointmentCount = dayAppointments.length;
                const counselorCount = new Set(dayAppointments.map(a => a.counselorId)).size;
                const isToday = new Date(dateStr).toDateString() === new Date().toDateString();

                days.push(
                    <div key={day} className="border-t border-l p-1 text-sm h-24 flex flex-col">
                        <div className={`self-start ${isToday ? 'bg-blue-600 text-white rounded-full h-6 w-6 flex items-center justify-center' : ''}`}>{day}</div>
                        {appointmentCount > 0 && 
                            <div className="flex-grow flex flex-col items-end justify-end gap-1 text-xs font-bold p-1">
                                <div className="flex items-center gap-1">
                                  <span className="text-blue-600" title="å•æ—¥å’¨è¯¢æ•°é‡">{appointmentCount}</span>
                                  <span className="w-2 h-2 bg-blue-500 rounded-full"></span>
                                </div>
                                <div className="flex items-center gap-1">
                                  <span className="text-green-600" title="åœ¨å²—å’¨è¯¢å¸ˆæ•°é‡">{counselorCount}</span>
                                  <span className="w-2 h-2 bg-green-500 rounded-full"></span>
                                </div>
                            </div>
                        }
                    </div>
                );
            }
            return (
                <div>
                    <h3 className="text-lg font-semibold text-center mb-2">{date.toLocaleDateString('zh-CN', { month: 'long', year: 'numeric' })}</h3>
                    <div className="grid grid-cols-7 text-xs text-center border-r border-b">
                         {['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'].map(d => <div key={d} className="border-t border-l font-bold p-1 bg-gray-50">{d}</div>)}
                         {days}
                    </div>
                </div>
            )
        };
        
        const today = new Date();
        const month1 = new Date(today.getFullYear(), today.getMonth(), 1);
        const month2 = new Date(today.getFullYear(), today.getMonth() + 1, 1);
        const month3 = new Date(today.getFullYear(), today.getMonth() + 2, 1);
        
        return (
            <div>
                <div className="flex justify-end gap-4 text-xs mb-2">
                    <span><span className="font-bold text-blue-600">â– </span> å•æ—¥å’¨è¯¢æ•°é‡</span>
                    <span><span className="font-bold text-green-600">â– </span> åœ¨å²—å’¨è¯¢å¸ˆæ•°é‡</span>
                </div>
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    {renderMonth(month1)}
                    {renderMonth(month2)}
                    {renderMonth(month3)}
                </div>
            </div>
        );
    };
    
    const AppointmentForm = ({ onSave, onCancel, onDelete, appointmentToEdit, clients, counselors }) => {
        const { useState } = React;
        const [formData, setFormData] = useState({
            id: appointmentToEdit?.id || null,
            date: appointmentToEdit?.date || new Date().toISOString().split('T')[0],
            time: appointmentToEdit?.time || '09:00',
            location: appointmentToEdit?.location || '',
            clientId: appointmentToEdit?.clientId || (clients[0]?.id || ''),
            counselorId: appointmentToEdit?.counselorId || (counselors[0]?.id || ''),
            notes: appointmentToEdit?.notes || '',
        });
        
        const handleChange = (e) => {
            const { name, value } = e.target;
            setFormData(prev => ({...prev, [name]: value}));
        };

        const handleSubmit = (e) => {
            e.preventDefault();
            if (!formData.clientId || !formData.counselorId) {
                alert('è¯·é€‰æ‹©æ¥è®¿è€…å’Œå’¨è¯¢å¸ˆ');
                return;
            }
            onSave(formData);
        };
        
        const handleDeleteClick = () => {
             if (window.confirm('ä½ ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ—¥ç¨‹å®‰æ’å—?')) {
                 onDelete(formData);
             }
        }

        return (
            <div className="bg-white p-6 rounded-lg shadow-md animate-fadeIn">
                <div className="flex justify-between items-center mb-4 pb-4 border-b">
                    <h3 className="text-2xl font-semibold text-gray-700">{appointmentToEdit ? 'ç¼–è¾‘' : 'æ·»åŠ '}æ—¥ç¨‹</h3>
                    <button onClick={onCancel} className="text-sm font-medium text-gray-600 hover:text-gray-900">â† è¿”å›æ—¥ç¨‹</button>
                </div>
                <form onSubmit={handleSubmit} className="space-y-4 max-w-lg mx-auto">
                    <div><label className="block text-sm font-medium">æ—¥æœŸ</label><input type="date" name="date" value={formData.date} onChange={handleChange} required className="w-full p-2 border rounded-md"/></div>
                    <div><label className="block text-sm font-medium">æ—¶é—´</label><input type="time" name="time" value={formData.time} onChange={handleChange} required className="w-full p-2 border rounded-md" step="3600"/></div>
                    <div><label className="block text-sm font-medium">å’¨è¯¢åœ°ç‚¹</label><input type="text" name="location" value={formData.location} onChange={handleChange} placeholder="ä¾‹å¦‚ï¼šå’¨è¯¢å®¤ 201 æˆ– çº¿ä¸Šä¼šè®®" className="w-full p-2 border rounded-md"/></div>
                    <div><label className="block text-sm font-medium">æ¥è®¿è€…</label><select name="clientId" value={formData.clientId} onChange={handleChange} required className="w-full p-2 border rounded-md">{clients.length > 0 ? clients.map(c => <option key={c.id} value={c.id}>{c.name}</option>) : <option disabled>è¯·å…ˆæ·»åŠ æ¥è®¿è€…</option>}</select></div>
                    <div><label className="block text-sm font-medium">å’¨è¯¢å¸ˆ</label><select name="counselorId" value={formData.counselorId} onChange={handleChange} required className="w-full p-2 border rounded-md">{counselors.length > 0 ? counselors.map(c => <option key={c.id} value={c.id}>{c.name}</option>) : <option disabled>è¯·å…ˆæ·»åŠ å’¨è¯¢å¸ˆ</option>}</select></div>
                    <div><label className="block text-sm font-medium">å¤‡æ³¨</label><textarea name="notes" value={formData.notes} onChange={handleChange} rows="3" className="w-full p-2 border rounded-md"></textarea></div>
                    <div className="flex justify-between items-center pt-4 border-t mt-6">
                       {appointmentToEdit && <button type="button" onClick={handleDeleteClick} className="px-4 py-2 text-white bg-red-600 hover:bg-red-700 rounded-md shadow-sm">åˆ é™¤</button>}
                       <div className="flex-grow flex justify-end space-x-3">
                           <button type="button" onClick={onCancel} className="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-md border">å–æ¶ˆ</button>
                           <button type="submit" className="px-4 py-2 text-white bg-blue-600 hover:bg-blue-700 rounded-md flex items-center shadow-sm"><span className="mr-2">ğŸ’¾</span>ä¿å­˜</button>
                       </div>
                    </div>
                </form>
            </div>
        );
    };

    const ClientManagementSection = ({ clients, onAddClient, onSelectClient }) => {
        const { useState } = React;
        const [view, setView] = useState('list');
        const [searchTerm, setSearchTerm] = useState('');
        const [clientToEdit, setClientToEdit] = useState(null);

        if (view === 'form') {
            return (
                <ClientForm 
                    onSave={(clientData, isEditing) => {
                        onAddClient(clientData, isEditing ? clientToEdit : null);
                        setView('list');
                    }}
                    onCancel={() => setView('list')}
                    clientToEdit={clientToEdit}
                    allClients={clients}
                />
            )
        }

        const filteredClients = clients.filter(client => client.name.toLowerCase().includes(searchTerm.toLowerCase()));
        return (
            <div className="bg-white p-6 rounded-lg shadow-md animate-fadeIn">
                <div className="flex justify-between items-center mb-6 pb-4 border-b"><h2 className="text-2xl font-semibold text-gray-700 flex items-center"><span className="mr-3 text-2xl">ğŸ‘¥</span>æ¥è®¿è€…ç®¡ç†</h2><button onClick={() => {setClientToEdit(null); setView('form');}} className="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg flex items-center shadow-sm"><span className="mr-2">â•</span>æ·»åŠ æ–°æ¥è®¿</button></div>
                <input type="text" placeholder="æœç´¢æ¥è®¿è€…å§“å..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="w-full p-3 mb-4 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"/>
                {filteredClients.length > 0 ? (
                    <ul className="space-y-3">{filteredClients.map(client => (<li key={client.id} onClick={() => onSelectClient(client)} className="bg-gray-50 hover:bg-blue-50 border rounded-lg p-4 cursor-pointer flex justify-between items-center transition-all duration-200 hover:shadow-md"><div><p className="text-lg font-medium text-blue-700">{client.name} <span className="text-sm text-gray-500">({client.gender}, {client.age}å²)</span></p><p className="text-sm text-gray-600">åŠ å…¥æ—¥æœŸ: {client.joinDate}</p></div><span className="text-gray-400 font-bold">â¯</span></li>))}</ul>
                ) : <p className="text-center text-gray-500 py-8">æš‚æ— åŒ¹é…çš„æ¥è®¿è€…ã€‚ç‚¹å‡»â€œæ·»åŠ æ–°æ¥è®¿â€å¼€å§‹ã€‚</p>}
            </div>
        );
    };

    const ClientForm = ({ onSave, onCancel, clientToEdit, allClients }) => {
      const { useState } = React;
      const [formData, setFormData] = useState({
        name: clientToEdit?.name || '', age: clientToEdit?.age || '', gender: clientToEdit?.gender || 'æœªé€éœ²',
        grade: clientToEdit?.grade || '', sexualOrientation: clientToEdit?.sexualOrientation || '',
        contact: clientToEdit?.contact || '', referredBy: clientToEdit?.referredBy || '',
        historyOfIllness: clientToEdit?.historyOfIllness || '', mentalStateScore: clientToEdit?.mentalStateScore || '5',
        disabilityStatus: clientToEdit?.disabilityStatus || '', religiousBelief: clientToEdit?.religiousBelief || '',
        ethnicIdentity: clientToEdit?.ethnicIdentity || '', personalFinance: clientToEdit?.personalFinance || '',
        familyFinance: clientToEdit?.familyFinance || '',
      });
      const handleChange = (e) => { const { name, value } = e.target; setFormData(prev => ({ ...prev, [name]: value })); };
      const handleSubmit = (e) => {
        e.preventDefault(); if (!formData.name.trim() || !formData.age) { alert('å§“åå’Œå¹´é¾„ä¸ºå¿…å¡«é¡¹ã€‚'); return; }
        const clientData = { ...formData, age: parseInt(formData.age), referredBy: formData.referredBy || null };
        onSave(clientData, !!clientToEdit);
      };
      const potentialReferrers = allClients.filter(c => c.id !== clientToEdit?.id);
      
      return (
        <div className="bg-white p-6 rounded-lg shadow-md animate-fadeIn">
            <div className="flex justify-between items-center mb-6 pb-4 border-b">
                <h3 className="text-2xl font-semibold text-gray-700">{clientToEdit ? 'ç¼–è¾‘' : 'æ·»åŠ '}æ¥è®¿è€…ä¿¡æ¯</h3>
                <button onClick={onCancel} className="text-sm font-medium text-gray-600 hover:text-gray-900">â† è¿”å›</button>
            </div>
            <form onSubmit={handleSubmit} className="space-y-4">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div><label className="block text-sm font-medium">å§“å <span className="text-red-500">*</span></label><input type="text" name="name" value={formData.name} onChange={handleChange} required className="w-full p-2 border rounded-md" /></div>
                <div><label className="block text-sm font-medium">å¹´é¾„ <span className="text-red-500">*</span></label><input type="number" name="age" value={formData.age} onChange={handleChange} required className="w-full p-2 border rounded-md" /></div>
                <div><label className="block text-sm font-medium">æ€§åˆ«</label><select name="gender" value={formData.gender} onChange={handleChange} className="w-full p-2 border rounded-md"><option>æœªé€éœ²</option><option>ç”·</option><option>å¥³</option><option>å…¶ä»–</option></select></div>
                <div><label className="block text-sm font-medium">åœ¨è¯»å¹´çº§/èŒä¸š</label><input type="text" name="grade" value={formData.grade} onChange={handleChange} className="w-full p-2 border rounded-md" /></div>
                <div><label className="block text-sm font-medium">æ€§å–å‘</label><input type="text" name="sexualOrientation" value={formData.sexualOrientation} onChange={handleChange} className="w-full p-2 border rounded-md" /></div>
                <div><label className="block text-sm font-medium">è”ç³»æ–¹å¼</label><input type="text" name="contact" value={formData.contact} onChange={handleChange} className="w-full p-2 border rounded-md" /></div>
                <div><label className="block text-sm font-medium">è½¬ä»‹ç»æ¥æº</label><select name="referredBy" value={formData.referredBy || ''} onChange={handleChange} className="w-full p-2 border rounded-md"><option value="">æ— </option>{potentialReferrers.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}</select></div>
                <div><label className="block text-sm font-medium">å¿ƒç†çŠ¶æ€è¯„åˆ†(1-10)</label><select name="mentalStateScore" value={formData.mentalStateScore} onChange={handleChange} className="w-full p-2 border rounded-md">{[...Array(10).keys()].map(i => <option key={i+1} value={i+1}>{i+1}</option>)}</select></div>
                <div className="md:col-span-2"><label className="block text-sm font-medium">æ—¢å¾€ç—…å²</label><textarea name="historyOfIllness" value={formData.historyOfIllness} onChange={handleChange} rows="2" className="w-full p-2 border rounded-md" ></textarea></div>
                <div className="md:col-span-2"><label className="block text-sm font-medium">æ®‹éšœæƒ…å†µ</label><input type="text" name="disabilityStatus" value={formData.disabilityStatus} onChange={handleChange} className="w-full p-2 border rounded-md" /></div>
                <div><label className="block text-sm font-medium">å®—æ•™ä¿¡ä»°</label><input type="text" name="religiousBelief" value={formData.religiousBelief} onChange={handleChange} className="w-full p-2 border rounded-md" /></div>
                <div><label className="block text-sm font-medium">ç§æ—è®¤åŒ</label><input type="text" name="ethnicIdentity" value={formData.ethnicIdentity} onChange={handleChange} className="w-full p-2 border rounded-md" /></div>
                <div><label className="block text-sm font-medium">ä¸ªäººç»æµ</label><input type="text" name="personalFinance" value={formData.personalFinance} onChange={handleChange} className="w-full p-2 border rounded-md" /></div>
                <div><label className="block text-sm font-medium">å®¶åº­ç»æµ</label><input type="text" name="familyFinance" value={formData.familyFinance} onChange={handleChange} className="w-full p-2 border rounded-md" /></div>
              </div>
              <div className="flex justify-end space-x-3 pt-4 border-t mt-6">
                  <button type="button" onClick={onCancel} className="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-md border">å–æ¶ˆ</button>
                  <button type="submit" className="px-4 py-2 text-white bg-blue-600 hover:bg-blue-700 rounded-md flex items-center shadow-sm">
                    <span className="mr-2">ğŸ’¾</span>{clientToEdit ? 'ä¿å­˜æ›´æ”¹' : 'æ·»åŠ æ¥è®¿è€…'}
                  </button>
              </div>
            </form>
        </div>
      );
    };

    const ClientDetailView = ({ client, allClients, onUpdateClient, onDeleteClient, globalLoadingMessage, setGlobalLoadingMessage, showAlert }) => {
      const { useState } = React;
      const [isEditing, setIsEditing] = useState(false);
      
      if (isEditing) {
          return <ClientForm 
            clientToEdit={client}
            allClients={allClients}
            onSave={(clientData) => {
                onUpdateClient({ ...client, ...clientData }, true);
                setIsEditing(false);
            }}
            onCancel={() => setIsEditing(false)}
          />
      }

      return (
        <div className="bg-white p-6 rounded-lg shadow-md animate-fadeIn">
          <div className="flex flex-col md:flex-row justify-between md:items-center mb-4 pb-4 border-b gap-4">
            <h2 className="text-2xl font-semibold text-gray-700 flex items-center"><span className="mr-3 text-3xl">ğŸ‘¤</span>{client.name} - æ¡£æ¡ˆä¸­å¿ƒ</h2>
            <div>
              <button onClick={() => setIsEditing(true)} className="text-sm font-medium text-blue-600 hover:text-blue-800 mr-4 flex items-center"><span className="mr-1">âœï¸</span>ç¼–è¾‘</button>
              <button onClick={() => {if(window.confirm('ç¡®å®šè¦åˆ é™¤æ­¤æ¥è®¿è€…å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {onDeleteClient(client.id)}}} className="text-sm font-medium text-red-600 hover:text-red-800 flex items-center"><span className="mr-1">ğŸ—‘ï¸</span>åˆ é™¤</button>
            </div>
          </div>
          <ClientProfileTabs client={client} allClients={allClients} onUpdateClient={onUpdateClient} globalLoadingMessage={globalLoadingMessage} setGlobalLoadingMessage={setGlobalLoadingMessage} showAlert={showAlert} />
        </div>
      );
    };

    const ClientProfileTabs = ({ client, allClients, onUpdateClient, globalLoadingMessage, setGlobalLoadingMessage, showAlert }) => {
        const { useState, useRef } = React;
        const [activeTab, setActiveTab] = useState('profile');
        const tabs = [{ id: 'profile', label: 'æ¡£æ¡ˆä¸ä¼šè¯', icon: 'ğŸ‘¤' }, { id: 'conceptualization', label: 'AIä¸ªæ¡ˆæ¦‚å¿µåŒ–', icon: 'ğŸ“œ' },{ id: 'analysis', label: 'æ¥è®¿è€…è¯„ä¼°', icon: 'ğŸ“Š' }, { id: 'supervision', label: 'AIç£å¯¼', icon: 'ğŸ”¬' }];
      
        const readFileAsText = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = event => resolve(event.target.result);
                reader.onerror = error => reject(error);
                reader.readAsText(file, 'UTF-8');
            });
        };
      
        const triggerAiGeneration = async (currentClient, sessionId, transcriptContent, transcriptName) => {
            setGlobalLoadingMessage(`æ­£åœ¨ä¸º ${currentClient.name} ç”ŸæˆAIæŠ¥å‘Š...`);
            const session = currentClient.sessions.find(s => s.id === sessionId);
            if (!session) return;
            
            try {
                const clientInfoForPrompt = { ...currentClient };
                delete clientInfoForPrompt.sessions;

                const [conceptualizationRes, assessmentRes] = await Promise.all([
                    fetch('/api/ai/conceptualization', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ client_info: clientInfoForPrompt, transcript_content: transcriptContent })
                    }),
                    fetch('/api/ai/assessment', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ client_info: clientInfoForPrompt, transcript_content: transcriptContent })
                    })
                ]);

                if (!conceptualizationRes.ok || !assessmentRes.ok) throw new Error("AI API è°ƒç”¨å¤±è´¥");

                const conceptualization = await conceptualizationRes.json();
                const assessment = await assessmentRes.json();

                const updatedClient = JSON.parse(JSON.stringify(currentClient));
                const sIndex = updatedClient.sessions.findIndex(s => s.id === sessionId);
                updatedClient.sessions[sIndex].transcript = { name: transcriptName, content: transcriptContent };
                updatedClient.sessions[sIndex].conceptualization = conceptualization;
                updatedClient.sessions[sIndex].assessment = assessment;
                
                onUpdateClient(updatedClient);
                showAlert('AIæŠ¥å‘Šå·²æˆåŠŸç”Ÿæˆï¼');

            } catch (error) {
                showAlert(`AIæŠ¥å‘Šç”Ÿæˆå¤±è´¥: ${error.message}`);
            } finally {
                setGlobalLoadingMessage('');
            }
        };

      const handleAddSession = (newSessionData) => {
        const newSession = { id: `session-${client.id}-${Date.now()}`, ...newSessionData, transcript: null, conceptualization: { status: 'Pending' }, assessment: { status: 'Pending' }, supervision: { status: 'Pending', conceptualizationUploaded: null, assessmentUploaded: null, content: null } };
        onUpdateClient({ ...client, sessions: [...(client.sessions || []), newSession] });
      };

      const handleFileUpload = async (sessionId, file) => {
        try {
            const content = await readFileAsText(file);
            const sessionIndex = client.sessions.findIndex(s => s.id === sessionId);
            if (sessionIndex === -1) return;
            let updatedClient = JSON.parse(JSON.stringify(client));
            updatedClient.sessions[sessionIndex].transcript = { name: file.name, content: content };
            
            onUpdateClient(updatedClient, (finalUpdatedClient) => {
                triggerAiGeneration(finalUpdatedClient, sessionId, content, file.name);
            });
        } catch(e) {
            showAlert(`è¯»å–æ–‡ä»¶å¤±è´¥: ${e.message}`);
        }
      };

      const handleSupervisionFileUploaded = async (sessionId, fileType, file) => {
          try {
              const fileContent = await readFileAsText(file);
              const sessionIndex = client.sessions.findIndex(s => s.id === sessionId);
              if (sessionIndex === -1) return;

              let updatedClient = JSON.parse(JSON.stringify(client));
              updatedClient.sessions[sessionIndex].supervision[fileType + 'Uploaded'] = { name: file.name, content: fileContent };
              onUpdateClient(updatedClient, (finalUpdatedClient) => {
                  const finalSession = finalUpdatedClient.sessions.find(s => s.id === sessionId);
                  if (finalSession.supervision.conceptualizationUploaded && finalSession.supervision.assessmentUploaded && finalSession.supervision.status !== 'Complete' && finalSession.supervision.status !== 'Processing') {
                      triggerSupervisionGeneration(finalUpdatedClient, sessionId);
                  }
              });
          } catch (e) {
              showAlert(`è¯»å–ç£å¯¼æ–‡ä»¶å¤±è´¥: ${e.message}`);
          }
      };
      
      const triggerSupervisionGeneration = async (clientForSupervision, sessionId) => {
          setGlobalLoadingMessage(`æ­£åœ¨ä¸º ${clientForSupervision.name} ç”Ÿæˆæœ€ç»ˆç£å¯¼æŠ¥å‘Š...`);
          const session = clientForSupervision.sessions.find(s => s.id === sessionId);
          if (!session) return;

          try {
              const clientInfoForPrompt = { ...clientForSupervision };
              delete clientInfoForPrompt.sessions;

              const response = await fetch('/api/ai/supervision', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    client_info: clientInfoForPrompt,
                    transcript_content: session.transcript.content,
                    conceptualization_content: session.supervision.conceptualizationUploaded.content,
                    assessment_content: session.supervision.assessmentUploaded.content
                })
              });

              if (!response.ok) throw new Error("AIç£å¯¼æŠ¥å‘Šç”Ÿæˆå¤±è´¥");

              const supervisionData = await response.json();
              
              const finalClient = JSON.parse(JSON.stringify(clientForSupervision));
              const sIndex = finalClient.sessions.findIndex(s => s.id === sessionId);
              finalClient.sessions[sIndex].supervision = { ...finalClient.sessions[sIndex].supervision, ...supervisionData.supervision };
              onUpdateClient(finalClient);
              showAlert('AIç£å¯¼æŠ¥å‘Šå·²æˆåŠŸç”Ÿæˆï¼');
          } catch(error) {
              showAlert(`AIç£å¯¼æŠ¥å‘Šç”Ÿæˆå¤±è´¥: ${error.message}`);
          } finally {
              setGlobalLoadingMessage('');
          }
      };

        const renderTabContent = () => {
            const isLoading = !!globalLoadingMessage;
            switch (activeTab) {
            case 'profile': return <ClientProfileTab client={client} allClients={allClients} onAddSession={handleAddSession} onFileUpload={handleFileUpload} isAiLoading={isLoading} />;
            case 'conceptualization': return <ReportDisplayTab client={client} reportType="conceptualization" title="AIä¸ªæ¡ˆæ¦‚å¿µåŒ–" themeColor="indigo" />;
            case 'analysis': return <ReportDisplayTab client={client} reportType="assessment" title="æ¥è®¿è€…è¯„ä¼°" themeColor="green" />;
            case 'supervision': return <SupervisionReportTab client={client} onSupervisionFileUploaded={handleSupervisionFileUploaded} isAiLoading={isLoading} />;
            default: return null;
            }
        };

        return (
            <div>
                 <div className="border-b border-gray-200"><nav className="-mb-px flex space-x-6 overflow-x-auto">{tabs.map(tab => <button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`flex-shrink-0 whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm flex items-center ${activeTab === tab.id ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}`}><span className="mr-2">{tab.icon}</span>{tab.label}</button>)}</nav></div>
                <div className="pt-6">{renderTabContent()}</div>
            </div>
        )
    }

    const ClientProfileTab = ({ client, allClients, onAddSession, onFileUpload, isAiLoading }) => {
      const { useState, useRef } = React;
      const [showAddSession, setShowAddSession] = useState(false);
      const [newSessionDate, setNewSessionDate] = useState(new Date().toISOString().split('T')[0]);
      const handleCreateSession = () => { if (!newSessionDate) return; onAddSession({ date: newSessionDate, summary: `å…³äº ${newSessionDate} çš„å’¨è¯¢` }); setShowAddSession(false); };
      
      const SessionCard = ({ session }) => {
        const fileInputRef = useRef(null);
        const status = session.conceptualization?.status;
        const colorMap = { Pending: 'yellow', Processing: 'blue', Complete: 'green', Error: 'red' };
        const statusColor = colorMap[status] || 'gray';

        const handleFileSelect = (event) => {
            const file = event.target.files[0];
            if (file) onFileUpload(session.id, file);
        };
        return (
            <div className={`p-4 bg-white rounded-lg border border-gray-200 shadow-sm transition-all ${status === 'Processing' && 'animate-pulse'}`}>
                <div className="flex justify-between items-start">
                    <p className="font-semibold text-gray-800">å’¨è¯¢æ—¥æœŸ: {session.date}</p>
                    {session.transcript && <div className={`text-xs font-medium px-2 py-0.5 rounded-full bg-${statusColor}-100 text-${statusColor}-800`}>æŠ¥å‘ŠçŠ¶æ€: {status}</div>}
                </div>
                <div className="mt-3 p-3 bg-gray-50 rounded-md text-center">
                    <p className="text-sm font-medium text-gray-600">å’¨è¯¢é€å­—ç¨¿</p>
                    {session.transcript ? (<div className="text-green-600 mt-1 flex items-center justify-center gap-2"><span className="text-xl">âœ…</span><p className="text-xs break-all font-mono">{session.transcript.name}</p></div>) : (
                        <>
                            <input type="file" ref={fileInputRef} onChange={handleFileSelect} className="hidden" accept=".txt,.md"/>
                            <button onClick={() => fileInputRef.current.click()} disabled={isAiLoading} className="mt-1 text-xs bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-1 px-3 rounded shadow-sm disabled:opacity-50 disabled:cursor-not-allowed">ä¸Šä¼ å¹¶ç”ŸæˆAIæŠ¥å‘Š</button>
                        </>
                    )}
                </div>
            </div>
        );
      }
      const referrer = client.referredBy ? allClients.find(c => c.id === client.referredBy) : null;
      const referredList = client.referredClients?.map(id => allClients.find(c => c.id === id)).filter(Boolean);
      return (
        <div className="space-y-6">
            <div className="p-4 bg-gray-50 rounded-lg border">
                <h3 className="text-lg font-semibold text-gray-700 mb-3 flex items-center"><span className="mr-2">â„¹ï¸</span>åŸºæœ¬ä¿¡æ¯</h3>
                <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-x-6 gap-y-4 text-sm">
                    <p><strong>å§“å:</strong> {client.name}</p><p><strong>å¹´é¾„:</strong> {client.age} å²</p><p><strong>æ€§åˆ«:</strong> {client.gender}</p>
                    <p><strong>èŒä¸š/å¹´çº§:</strong> {client.grade || 'æœªæä¾›'}</p><p><strong>æ€§å–å‘:</strong> {client.sexualOrientation || 'æœªæä¾›'}</p><p><strong>è”ç³»æ–¹å¼:</strong> {client.contact || 'æœªæä¾›'}</p>
                    <p><strong>è½¬ä»‹ç»æ¥æº:</strong> {referrer ? referrer.name : 'æ— '}</p><p><strong>å·²è½¬ä»‹ç»:</strong> {referredList?.length > 0 ? referredList.map(c => c.name).join(', ') : 'æ— '}</p><p><strong>å¿ƒç†çŠ¶æ€è¯„åˆ†:</strong> {client.mentalStateScore}/10</p>
                    <p className="md:col-span-3"><strong>æ—¢å¾€ç—…å²:</strong> {client.historyOfIllness || 'æœªæä¾›'}</p>
                    <p className="md:col-span-3"><strong>æ®‹éšœæƒ…å†µ:</strong> {client.disabilityStatus || 'æœªæä¾›'}</p>
                    <p><strong>å®—æ•™ä¿¡ä»°:</strong> {client.religiousBelief || 'æœªæä¾›'}</p><p><strong>ç§æ—è®¤åŒ:</strong> {client.ethnicIdentity || 'æœªæä¾›'}</p>
                    <p><strong>ä¸ªäººç»æµ:</strong> {client.personalFinance || 'æœªæä¾›'}</p><p><strong>å®¶åº­ç»æµ:</strong> {client.familyFinance || 'æœªæä¾›'}</p>
                </div>
            </div>
            <div>
                <div className="flex justify-between items-center mb-3"><h3 className="text-lg font-semibold text-gray-700 flex items-center"><span className="mr-2">ğŸ“…</span>å’¨è¯¢ä¼šè¯å·¥ä½œæµ</h3><button onClick={() => setShowAddSession(true)} className="text-sm bg-blue-600 hover:bg-blue-700 text-white font-semibold py-1 px-3 rounded-md shadow-sm">æ·»åŠ æ–°ä¼šè¯</button></div>
                {showAddSession && (<div className="p-4 mb-4 bg-blue-50 border rounded-lg flex items-center gap-4 animate-fadeIn"><input type="date" value={newSessionDate} onChange={e => setNewSessionDate(e.target.value)} className="p-2 border rounded-md"/><button onClick={handleCreateSession} className="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-md shadow-sm">åˆ›å»º</button><button onClick={() => setShowAddSession(false)} className="text-gray-600">å–æ¶ˆ</button></div>)}
                <div className="space-y-4">{client.sessions?.length > 0 ? [...client.sessions].reverse().map(session => <SessionCard key={session.id} session={session} />) : <p className="text-center text-gray-500 py-4">æš‚æ— å’¨è¯¢ä¼šè¯è®°å½•ã€‚</p>}</div>
            </div>
        </div>
      );
    };

    const ReportDisplayTab = ({ client, reportType, title, themeColor }) => {
        const { useState, useEffect } = React;
        const aiSessions = (client.sessions || []).filter(s => s[reportType] && s[reportType].status !== 'Pending');
        const [selectedSession, setSelectedSession] = useState(aiSessions.length > 0 ? aiSessions.slice().reverse()[0] : null);
        
        useEffect(() => {
            const sessions = (client.sessions || []).filter(s => s[reportType]?.status !== 'Pending');
            if (sessions.length > 0 && !sessions.some(s => s.id === selectedSession?.id)) {
                setSelectedSession(sessions.slice().reverse()[0]);
            } else if (sessions.length === 0) {
                setSelectedSession(null);
            }
        }, [client, reportType, selectedSession]);

        const report = selectedSession ? selectedSession[reportType] : null;

        return (
             <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div className="md:col-span-1 bg-gray-50 p-4 rounded-lg border"><h3 className="text-lg font-medium text-gray-700 mb-3">å†å²è®°å½•</h3><ul className="space-y-2 max-h-[60vh] overflow-y-auto pr-2">{aiSessions.length === 0 ? <p className="text-sm text-gray-500 text-center py-4">æš‚æ— è®°å½•ã€‚</p> : [...aiSessions].reverse().map(session => <li key={session.id} onClick={() => setSelectedSession(session)} className={`p-3 rounded-lg cursor-pointer border-2 ${selectedSession?.id === session.id ? `bg-${themeColor}-100 border-${themeColor}-500` : `bg-white hover:bg-gray-100 border-transparent`}`}><p className={`font-semibold text-${themeColor}-600`}>å’¨è¯¢æ—¥æœŸ: {session.date}</p><p className={`text-xs font-medium mt-1 text-${session[reportType].status === 'Complete' ? 'green-600' : 'red-600'}`}>çŠ¶æ€: {session[reportType].status}</p></li>)}</ul></div>
                <div className="md:col-span-2"><h3 className="text-lg font-medium mb-3 text-gray-700">{title}è¯¦æƒ…</h3>{report ? <div className="p-4 bg-white border rounded-lg h-full"><div className="flex justify-between items-center mb-2"><h4 className={`font-bold text-lg text-${themeColor}-700`}>å…³äº {selectedSession.date} å’¨è¯¢çš„{title}</h4><button onClick={()=>downloadTextAsFile(report.content, `${client.name}_${selectedSession.date}_${reportType}.txt`)} className="text-xs bg-gray-600 text-white py-1 px-2 rounded hover:bg-gray-700">ä¸‹è½½</button></div><div className="whitespace-pre-wrap text-gray-800 bg-gray-50 p-3 mt-3 rounded-md overflow-y-auto max-h-[55vh]">{report.content}</div></div> : <p className="text-gray-500 text-center pt-10">è¯·ä»å·¦ä¾§é€‰æ‹©è®°å½•æŸ¥çœ‹ã€‚</p>}</div>
            </div>
        );
    }

    const SupervisionReportTab = ({ client, onSupervisionFileUploaded, isAiLoading }) => {
        const { useState, useEffect, useRef } = React;
        const eligibleSessions = (client.sessions || []).filter(s => s.transcript);
        const [selectedSession, setSelectedSession] = useState(eligibleSessions.length > 0 ? eligibleSessions.slice().reverse()[0] : null);
        useEffect(() => { const sessions = (client.sessions || []).filter(s => s.transcript); setSelectedSession(sessions.length > 0 ? sessions.slice().reverse()[0] : null); }, [client]);
        
        const SupervisionWorkflow = ({ session }) => {
            const conceptualizationInputRef = useRef(null);
            const assessmentInputRef = useRef(null);
            const handleFileSelect = (event, fileType) => {
                const file = event.target.files[0];
                if(file) onSupervisionFileUploaded(session.id, fileType, file);
            }
            const isReadyForGeneration = session.supervision.conceptualizationUploaded && session.supervision.assessmentUploaded;

            return (
                <div className="p-4 bg-white border rounded-lg h-full space-y-4">
                    <div className="p-3 bg-gray-50 rounded-md">
                        <h4 className="text-md font-medium text-gray-700 mb-2">ç¬¬1æ­¥: ä¸Šä¼ å·²ç”Ÿæˆçš„æŠ¥å‘Šï¼ˆç”¨äºç£å¯¼ï¼‰</h4>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div><p className="text-sm text-center mb-1">ä¸ªæ¡ˆæ¦‚å¿µåŒ–æŠ¥å‘Š</p><button onClick={() => conceptualizationInputRef.current.click()} disabled={session.supervision.conceptualizationUploaded || session.conceptualization?.status !== 'Complete'} className="w-full text-xs bg-indigo-500 text-white py-1 px-2 rounded disabled:bg-gray-400 disabled:cursor-not-allowed">{session.supervision.conceptualizationUploaded ? `âœ… å·²ä¸Šä¼ ` : 'ä¸Šä¼  .txt æ–‡ä»¶'}</button><input type="file" ref={conceptualizationInputRef} onChange={(e) => handleFileSelect(e, 'conceptualization')} className="hidden" accept=".txt"/></div>
                            <div><p className="text-sm text-center mb-1">æ¥è®¿è€…è¯„ä¼°æŠ¥å‘Š</p><button onClick={() => assessmentInputRef.current.click()} disabled={session.supervision.assessmentUploaded || session.assessment?.status !== 'Complete'} className="w-full text-xs bg-indigo-500 text-white py-1 px-2 rounded disabled:bg-gray-400 disabled:cursor-not-allowed">{session.supervision.assessmentUploaded ? `âœ… å·²ä¸Šä¼ ` : 'ä¸Šä¼  .txt æ–‡ä»¶'}</button><input type="file" ref={assessmentInputRef} onChange={(e) => handleFileSelect(e, 'assessment')} className="hidden" accept=".txt"/></div>
                        </div>
                        <p className="text-xs text-gray-500 mt-2">æç¤ºï¼šè¯·å…ˆç¡®ä¿åˆæ­¥æŠ¥å‘Šå·²ç”Ÿæˆ(çŠ¶æ€ä¸ºComplete)ã€‚ä¸Šä¼ ä¸¤ä»½æŠ¥å‘Šåå°†è‡ªåŠ¨è§¦å‘æœ€ç»ˆç£å¯¼æŠ¥å‘Šç”Ÿæˆã€‚</p>
                    </div>
                    <div className="p-3 bg-gray-50 rounded-md">
                        <h4 className="text-md font-medium text-gray-700 mb-2">ç¬¬2æ­¥: æŸ¥çœ‹æœ€ç»ˆç£å¯¼æŠ¥å‘Š</h4>
                        {session.supervision.status === 'Processing' && <p className="text-sm text-blue-600 animate-pulse">æ­£åœ¨ç”Ÿæˆä¸­...</p>}
                        {session.supervision.status === 'Complete' ? <button onClick={()=>downloadTextAsFile(session.supervision.content, `${client.name}_${selectedSession.date}_ç£å¯¼æŠ¥å‘Š.txt`)} className="text-sm bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded shadow-sm">ä¸‹è½½ç£å¯¼æŠ¥å‘Š</button> : <p className="text-sm text-gray-500">çŠ¶æ€: {session.supervision.status === 'Pending' ? 'å¾…ä¸Šä¼ æ–‡ä»¶' : session.supervision.status}</p>}
                        {session.supervision.status === 'Error' && <p className="text-sm text-red-600">{session.supervision.content}</p>}
                    </div>
                </div>
            );
        };
        return (
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div className="md:col-span-1 bg-gray-50 p-4 rounded-lg border"><h3 className="text-lg font-medium text-gray-700 mb-3">ä¼šè¯åˆ—è¡¨</h3><ul className="space-y-2 max-h-[60vh] overflow-y-auto pr-2">{eligibleSessions.length === 0 ? <p className="text-sm text-gray-500 text-center py-4">æš‚æ— ç¬¦åˆæ¡ä»¶çš„ä¼šè¯ã€‚</p> : [...eligibleSessions].reverse().map(session => <li key={session.id} onClick={() => setSelectedSession(session)} className={`p-3 rounded-lg cursor-pointer border-2 ${selectedSession?.id === session.id ? 'bg-blue-100 border-blue-500' : 'bg-white hover:bg-gray-100 border-transparent'}`}><p className="font-semibold text-blue-600">å’¨è¯¢æ—¥æœŸ: {session.date}</p><p className={`text-xs font-medium mt-1 ${session.supervision.status === 'Complete' ? 'text-green-600' : 'text-yellow-600'}`}>ç£å¯¼çŠ¶æ€: {session.supervision.status}</p></li>)}</ul></div>
                <div className="md:col-span-2"><h3 className="text-lg font-medium mb-3 text-gray-700">AIç£å¯¼å·¥ä½œæµ</h3>{selectedSession ? <SupervisionWorkflow session={selectedSession}/> : <p className="text-gray-500 text-center pt-10">è¯·ä»å·¦ä¾§é€‰æ‹©ä¸€ä¸ªä¼šè¯ä»¥å¼€å§‹ç£å¯¼æµç¨‹ã€‚</p>}</div>
            </div>
        );
    };

    const CBTSection = ({ showAlert }) => {
      return (
          <div className="bg-white p-6 rounded-lg shadow-md animate-fadeIn max-w-4xl mx-auto">
              <h2 className="text-2xl font-semibold mb-6 text-gray-700 border-b pb-3 flex items-center"><span className="text-2xl mr-3">ğŸ§ </span>è¾…åŠ©å·¥å…·</h2>
              <div className="text-center p-8 bg-gray-50 rounded-lg">
                  <h3 className="text-xl font-bold text-gray-600">åŠŸèƒ½å¼€å‘ä¸­</h3>
                  <p className="mt-2 text-gray-500">æ­¤æ¨¡å—ï¼ˆå¦‚CBTç»ƒä¹ å·¥å…·ï¼‰æ­£åœ¨ç§¯æå¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…æœªæ¥çš„æ›´æ–°ï¼</p>
              </div>
          </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
